(function(b){function a(c){return c instanceof Number||(typeof c=="number")}b.fn.ibizLayout=function(g){var f=function(n,m){if(n&&g&&g.ctrler){var l=g.ctrler.getItem(n);if(l){l.setSize(m.width,m.height)}}};var k=function(m,l){};var d=function(m){if(m&&g&&g.ctrler){var l=g.ctrler.getItem(m);if(l){return{height:l.getHeight()}}}return{width:0,height:0}};var j=function(n,o){n.style.position="absolute";n.style.boxSizing="border-box";for(var m in o){try{var l=o[m];if(a(l)){l=parseInt(l)+"px"}n.style[m]=l}catch(p){}}k(n.getAttribute("data-ibiz-layout-item"),o)};var c=function(m,l){if(m[m.length-1]==="%"){return l*parseInt(m)/100}return parseInt(m)};var h=function(q,o,m,l){var p=c(q,o);if(m){m=c(m,o);if(p<m){return m}}if(l){l=c(l,o);if(p>l){return l}}return p};return this.each(function(){this.style.boxSizing="border-box";this.style.overflow="hidden";if(this==document.body||b(this).hasClass("ibiz-layout--body")){j(this,{top:0,bottom:0,left:0,right:0})}var H=b(this).hasClass("ibiz-layout--h");var G=this.clientWidth;var F=this.clientHeight;var L=0;var q=this.children;var P,K,C,w,r,t,D,I,A,p;while(L<q.length){var s=q[L++];var R=s.getAttribute("data-ibiz-layout");var z=s.getAttribute("data-ibiz-layout-item");if(!R){continue}R=R.replace(/(['"])?([a-zA-Z0-9\-]+)(['"])?:/g,'"$2":');R=R.replace(/'/g,'"');R="{"+R+"}";try{R=JSON.parse(R)}catch(J){continue}var n=R.region;if(!n){continue}s._data=R;if(/center/i.test(n)){P=s;t=z;continue}if(/north/i.test(n)){K=s;D=z;continue}if(/south/i.test(n)){C=s;I=z;continue}if(/east/i.test(n)){w=s;A=z;continue}if(/west/i.test(n)){r=s;p=z}}var O=parseInt(this.style.paddingLeft)||0;var l=parseInt(this.style.paddingRight)||0;var N=parseInt(this.style.paddingTop)||0;var v=parseInt(this.style.paddingBottom)||0;var x=G-O-l,y=F-N-v,E=N,o=O,M,Q;function m(){if(r){M=r._data.width;if(M){M=h(M,G,r._data["min-width"],r._data["max-width"]);o=M;Q=parseInt(r._data.left)||O;if(Q){x-=Q;o+=Q}x-=M;j(r,{top:E,left:Q,width:M,height:y});f(p,{top:E,left:Q,width:M,height:y})}}if(w){M=w._data.width;if(M){M=h(M,G,w._data["min-width"],w._data["max-width"]);Q=parseInt(w._data.right)||l;if(Q){x-=Q}x-=M;j(w,{top:E,right:Q,width:M,height:y});f(A,{top:E,right:Q,width:M,height:y})}}}function u(){if(K){M=K._data.height;if(M=="auto"){var S=d(D);M=S.height.toString()}if(M){M=h(M,F,K._data["min-height"],K._data["max-height"]);y-=M;E=M;j(K,{top:N,left:o,width:x,height:M});if(K._data.height!="auto"){f(D,{top:N,left:o,width:x,height:M})}}}if(C){M=C._data.height;if(M=="auto"){var S=d(I);M=S.height.toString()}if(M){M=h(M,F,C._data["min-height"],C._data["max-height"]);y-=M;j(C,{bottom:v,left:o,height:M,width:x});if(C._data.height!="auto"){f(I,{bottom:v,left:o,width:x,height:M})}}}}if(H){m();u()}else{u();m()}if(P){j(P,{top:E,left:o,width:x,height:y});f(t,{top:E,left:o,width:x,height:y})}})}})(jQuery);var IBizApp_Data=null;var IBiz={ajax:function(f){if(!f||!f.url){return}var c=f.url;var h=f.method?f.method:"POST";var g=f.params?f.params:{};var a=f.dataType?f.dataType:"json";var b=f.success;var d=f.failure;if(!c){return}if(!h){h="POST"}if(!g){g={}}$.ajax({traditional:true,type:h,cache:false,url:c,dataType:a,data:g,success:function(j){if(j.type=="error"||j.type=="warning"||j.type=="failure"){if(d){d(j)}}else{if(b){b(j)}}},error:function(j,l,k){if(d){d(l)}},statusCode:{403:function(){if(d){d(e)}},404:function(){if(d){d(e)}}}})},alert:function(d,c,f){if(!f){f=-1}if(f==1){$.bootstrapGrowl(c,{ele:"body",type:"info",offset:{from:"top",amount:250},align:"center",width:250,delay:5000,allow_dismiss:true,stackup_spacing:10});return}if(!d||d==""){switch(f){case 0:d="警告";break;case -1:case 1:d="信息";break;case 2:d="错误";break;default:d="信息"}}var a;try{if(window.opener&&window.opener.window){a=layer}else{a=window.rootlayer}}catch(b){a=window.rootlayer}a.alert(c,{icon:f,title:d})},confirm2:function(f,d,h,g){if(!h){h=-1}if(!f||f==""){switch(h){case 0:f="警告";break;case -1:case 1:f="信息";break;case 2:f="错误";break;default:f="信息"}}var b;try{if(window.opener&&window.opener.window){b=layer}else{b=window.rootlayer}}catch(c){b=window.rootlayer}var a=b.confirm(d,{icon:h,title:f,btn:["确定","取消"]},function(){window.rootlayer.close(a);if(g){g(true)}},function(){b.close(a);if(g){g(false)}})},confirm:function(a,b){IBiz.confirm3(window,a,b)},confirm3:function(g,f,h){var b=g||window;var c;try{if(b.opener&&b.opener.window){c=layer}else{c=b.rootlayer}}catch(d){c=b.rootlayer}var a=c.confirm(f,{btn:["确定","取消"]},function(){b.rootlayer.close(a);if(h){h(true)}},function(){c.close(a);if(h){h(false)}})},beginload:function(){var b;try{if(window.opener&&window.opener.window){b=layer}else{b=window.rootlayer}}catch(c){b=window.rootlayer}var a=b.load(0,{shade:[0.1,"#fff"]});return a},endload:function(a){var b;try{if(window.opener&&window.opener.window){b=layer}else{b=window.rootlayer}}catch(c){b=window.rootlayer}b.close(a)},isNull:function(a){return(a==null||a==undefined)},getValue:function(b,a){if(b==undefined||b==null){return a}return b},parseString:function(a){if(a.replace){a=a.replace(/\\\[/g,"[");a=a.replace(/\\]/g,"]");a=a.replace(/\\{/g,"{");a=a.replace(/\\}/g,"}");a=a.replace(/\\'/g,"'");return a.replace(/\\"/g,'"')}else{return""}},parseXML:function(b){var a=null;if(Ext.isIE){a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(b)}else{B=new DOMParser();a=B.parseFromString(b,"text/xml")}return a},loadXMLNode:function(d,c){if(c==null||c==undefined){c={}}for(var b=0;b<d.attributes.length;b++){var a=d.attributes.item(b).name;var f=d.attributes.item(b).value;a=a.toLowerCase();c[a]=f}return c},saveXMLNode:function(a,d){var b="";for(b in d){var c=d[b].toString();if(c!=""){a.attrib(b,c)}}},testCond:function(c,d,a){if(d=="EQ"){return c==a}if(d=="GT"){}if(d=="GTANDEQ"){}if(d=="IN"){}if(d=="ISNOTNULL"){return(c!=null&&c!="")}if(d=="ISNULL"){return(c==null||c=="")}if(d=="LEFTLIKE"){return(c&&a&&(c.toUpperCase().indexOf(a.toUpperCase())==0))}if(d=="LIKE"){return(c&&a&&(c.toUpperCase().indexOf(a.toUpperCase())!=-1))}if(d=="LT"){}if(d=="LTANDEQ"){}if(d=="NOTEQ"){return c!=a}if(d=="NOTIN"){}if(d=="RIGHTLIKE"){if(!(c&&a)){return false}var b=c.toUpperCase().indexOf(a.toUpperCase());if(b==-1){return false}return b+a.length==c.length}if(d=="TESTNULL"){}if(d=="USERLIKE"){}return false},processResult:function(o){if(o.url!=null&&o.url!=""){window.location.href=o.url}if(o.code!=null&&o.code!=""){eval(o.code)}if(o.downloadurl!=null&&o.downloadurl!=""){var downloadurl=BASEURL+o.downloadurl;IBiz.download(downloadurl)}},processResultBefore:function(o){if(o.bcode!=undefined&&o.bcode!=null&&o.bcode!=""){eval(o.bcode)}},download:function(a){window.open(a,"","resizable=1,menubar=0,status=0,titlebar=0,toolbar=0,scrollbars=0,width=30,height=30",false)},createGrid:function(a){return new IBizDataGrid2(a)},createToolbar:function(a){return new IBizToolbar(a)},createEditForm:function(a){return new IBizEditForm(a)},createDataInfoBar:function(a){return new IBizDataInfoBar(a)},createSearchForm:function(a){return new IBizSearchForm(a)},createDataView:function(a){return new IBizDataView(a)},createTree:function(a){return new IBizTree(a)}};!function(a,b){$.getIBizApp=function(){var d=false;if($.ibizapp){try{if($.ibizapp.isValid()){return $.ibizapp}else{$.ibizapp=null;d=true}}catch(f){$.ibizapp=null;d=true}}if(!d){try{if(a.parent&&a.parent.rootlayer){a.rootlayer=a.parent.rootlayer}else{a.rootlayer=a.layer}if(a.parent&&a.parent.ibizapp){a.ibizapp=a.parent.ibizapp;$.ibizapp=a.ibizapp;if($.ibizapp){return $.ibizapp}}if(a.opener){if(a.opener.window){if(a.opener.window.ibizapp){var c=null;$.each(document.location.search.substr(1).split("&"),function(k,j){var h=j.split("=");var g=h[0].toLowerCase();if(g=="windowid"){c=decodeURIComponent(h[1])}});if(c){$.ibizapp=a.ibizapp=a.opener.window.ibizapp;if($.ibizapp){return $.ibizapp}}}}}}catch(f){}}else{a.rootlayer=a.layer}a.ibizapp={autoId:1,ctrllers:{},windows:{},regSRFController:function(g){this.ctrllers[g.getId()]=g},unRegSRFController:function(g){var h=g.getId();g.quit();this.ctrllers[h]=null;delete this.ctrllers[h]},unRegSRFController2:function(g){this.ctrllers[g]=null;delete this.ctrllers[g]},getSRFController:function(g){return this.ctrllers[g]},checkSRFControllers:function(){try{var h=false;while(!h){h=true;for(var g in this.ctrllers){var j=this.ctrllers[g];try{if(j.isClosed()){this.unRegSRFController(j);h=false;break}}catch(k){this.unRegSRFController2(g);h=false;break}}}this.lastTimer=new Date().getTime()}catch(k){}},genUUID:function(){return a.ibizapp.autoId++},createWindowByView:function(g){var h=this;var j=new IBizWindow({});h.windows[j.getId()]=j;j.title=g.title;j.height=g.height?g.height:0;j.width=g.width?g.width:0;j.url=BASEURL+"/jsp"+g.viewurl+"?"+(g.viewparam?$.param(g.viewparam):"");return j},createWindow:function(g){var j=this;var h=new IBizWindow(g);j.windows[h.getId()]=h;return h},findWindow:function(g){var h=this;if(h.windows){return h.windows[g]}return null},releaseWindow:function(g){var h=this;h.windows[g]=null;delete h.windows[g]},parseURL:function(g,h,k){var j;if(h.toLowerCase().indexOf("http")!=-1){j=h}else{j=g+"/jsp"+h}if(k){return j+(h.indexOf("?")==-1?"?":"&")+$.param(k)}else{return j}},parseURL2:function(k,h,l){var j;var g;if(k){g=WEBROOTURL}else{g=BASEURL}if(h.toLowerCase().indexOf("http")!=-1){j=h}else{j=g+"/jsp"+h}if(l){return j+(h.indexOf("?")==-1?"?":"&")+$.param(l)}else{return j}},alert:function(j,h){if(!h){h=j}try{if(a.opener&&a.opener.window){mylayer=layer}else{mylayer=a.rootlayer}}catch(g){mylayer=a.rootlayer}mylayer.alert(h,{})},confirm:function(h,j){var g=a.rootlayer.confirm(h,{btn:["确定","取消"]},function(){a.rootlayer.close(g);if(j){j(true)}},function(){a.rootlayer.close(g);if(j){j(false)}})},ajax2:function(l){if(!l||!l.url){return}var j=l.url;var n=l.method?l.method:"POST";var m=l.params?l.params:{};var g=l.dataType?l.dataType:"json";var h=l.success;var k=l.failure;if(!j){return}if(!n){n="POST"}if(!m){m={}}$.ajax({traditional:true,type:n,cache:false,url:j,dataType:g,data:m,success:function(o){if(o.type=="error"||o.type=="warning"||o.type=="failure"){if(k){k(o)}}else{if(h){h(o)}}},error:function(o,q,p){if(k){k(q)}},statusCode:{403:function(){if(k){k(f)}},404:function(){if(k){k(f)}}}})},isValid:function(){try{var h=this;var g=new Date().getTime();if(h.lastTimer!=b){if(g-h.lastTimer>=10000){return false}else{return true}}return true}catch(j){return false}}};$.ibizapp=a.ibizapp;setInterval(function(){$.ibizapp.checkSRFControllers()},2000);return $.ibizapp};$.getIBizApp()}(window);function Class(){}Class.prototype.construct=function(){};Class.extend=function(f){var a=function(){if(arguments[0]!==Class){this.construct.apply(this,arguments)}};var d=new this(Class);var b=this.prototype;for(var g in f){var c=f[g];if(c instanceof Function){c.$=b}d[g]=c}a.prototype=d;a.extend=this.extend;return a};var IBizObject=Class.extend({construct:function(a){this.config=$.extend({},{},a);this.config.me=this;if(this.config.id){this.setId(this.config.id)}else{this.setId($.getIBizApp().genUUID())}if(this.config.name){this.setName(this.config.name)}else{if(this.config.refname){this.setName(this.config.refname)}else{this.setName(this.getId())}}if(this.config.refname){this.refname=this.config.refname;if(this.getController()){this.getController().registerItem(this.refname,this)}}this.e=$({})},init:function(a){this.onInit()},onInit:function(){},setId:function(a){this.id=a},getId:function(){return this.id},setName:function(a){this.name=a},getName:function(){return this.name},getRefName:function(){return this.refname},getController:function(){return this.config.ctrler},on:function(b,c,a){b=b.toLowerCase();this.e.bind(b,a,function(d,f){return c(f.sender,f.args,d)});return},fireEvent:function(c,b,a){c=c.toLowerCase();this.e.trigger(c,{sender:b,args:a})}});var IBizViewLogic=IBizObject.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this},init:function(){var a=this;if(a.getTrigger()=="TIMER"){if(a.getTimer()>1000){setInterval(function(){a.execute()},a.getTimer())}return}if(a.getTrigger()=="VIEWEVENT"){if(a.getEventCtrl()&&a.getEventCtrl()!=""){var b=a.getController().getItem(a.getEventCtrl());if(b){b.on(a.getEventName(),function(d,c,g){var f=g.data;f.execute(c)},a)}}else{a.getController().on(a.getEventName(),function(d,c,g){var f=g.data;f.execute(c)},a)}}},getTrigger:function(){return this.config.trigger},getTimer:function(){return this.config.timer},execute:function(a){var b=this.config.handler;if(b&&$.isFunction(b.execute)){b.execute(a,this)}},getTag:function(){return this.config.tag},getController:function(){return this.config.ctrler},getEventCtrl:function(){return this.config.eventctrl},getEventName:function(){return this.config.eventname}});var IBizControl=IBizObject.extend({load:function(a){},destroy:function(){},setSize:function(b,a){},setWidth:function(a){},setHeight:function(a){},isVisible:function(){return true},invoke:function(c,a){var b=this;b.onInvoke(c,a)},onInvoke:function(b,a){}});var IBizCodeList=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.datas=a.datas},getItemByValue:function(d,b){var c=this;var a;$.each(c.datas,function(f,g){if(g.value==d){a=g;return false}});return a}});var IBizCounter=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.counterid=b.config.counterid;b.tag=b.config.tag;b.counterparam=JSON.stringify(b.config.counterparam);b.timer=b.config.timer;b.url=b.getController().getBackendUrl();if(b.timer>1000){setInterval(function(){b.reload()},b.timer)}b.reload()},reload:function(){var a=this;var b={};b.srfcounterid=a.counterid;b.srfaction="FETCH";b.srfcounterparam=a.counterparam;IBiz.ajax({url:a.url,params:b,method:"POST",dataType:"json",success:function(c){if(c.ret==0){a.setData(c)}else{console.log("加载计数数据异常."+c.info)}},failure:function(c){}})},setData:function(b){var a=this;a.result=b;a.data=b.data;a.fireEvent(IBizCounter.COUNTERCHANGED,a,a.data)},getResult:function(){var a=this;return a.result},getData:function(){var a=this;return a.data}});IBizCounter.COUNTERCHANGED="COUNTERCHANGED";var IBizWindow=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.viewparam={};b.ownerwin=null;b.showmodel=false},getOpenerId:function(){return this.config.openerid},getParentParam:function(){return null},setOwnerWindow:function(b){var a=this},getOwnerWindow:function(){var a=this;return a.ownerwin},isShowModal:function(){var a=this;return a.showmodel},close:function(d){var b=this;var a=b.winIndex;try{b.ownerwin=null;window.rootlayer.close(a);window.layer.close(a)}catch(c){}try{if(d&&d.layer){d.layer.close(a)}if(d&&d.rootlayer){d.rootlayer.close(a)}}catch(c){}try{$.getIBizApp().releaseWindow(b.getId());if(b.callback){b.callback(b)}if(d){if(d.opener&&d.opener.window){d.close()}}}catch(c){}},open:function(){var a=this;a.openInNewWindow(window)},openModal:function(g){var j=this;j.showmodel=true;if(!j.width){if(g.outerWidth){j.width=g.outerWidth-100}else{j.width=$(g).width()-100}}if(!j.height){if(g.outerHeight){j.height=g.outerHeight-100}else{j.height=$(g).height()-100}}var k=j.viewparam||{};var a=$.extend({},k);for(var b in k){var l=k[b];if(l&&l.toString().length>100){delete a[b]}}var d=$.param(a);var c=j.url+"&"+d;var f;try{if(g.opener&&g.opener.window){f=g.layer}else{f=g.rootlayer}}catch(h){f=g.rootlayer}j.winIndex=f.open({type:2,area:[j.width+"px",j.height+"px"],title:j.title,fix:false,maxmin:true,content:c,cancel:function(n){if(j.beforecallback){var m=j.beforecallback(j);if(m){IBiz.confirm3(m.win,m.msg,function(o){if(o){j.close(m.win);return true}});return false}else{j.close(j.getOwnerWindow());return true}}else{j.close(j.getOwnerWindow());return true}}})},beforeClose:function(){var a=this;if(a.beforecallback){return a.beforecallback(a)}return false},openInNewWindow:function(g){var d=this;var b=d.viewparam||{};var c=$.extend({},b);for(var a in b){var f=b[a];if(f&&f.toString().length>100){delete c[a]}}var h=$.param(c);var j=d.url+"&"+h;setTimeout(function(){if(g&&g.parent){g.parent.window.open(j,"_blank")}else{window.open(j)}},1)}});var IBizPageContext=Class.extend({construct:function(a){var b=this;b.viewparam={};if(!a||!a.pcontroller){$.each(document.location.search.substr(1).split("&"),function(h,g){var f=g.split("=");var d=f[0].toLowerCase();if(d=="srfparentmode"||d=="srfparentdata"||d==""){return}b.viewparam[d]=decodeURIComponent(f[1])})}},getParamValue:function(a){var b=this;a=a.toLowerCase();return b.viewparam[a]},clear:function(){var a=this;a.viewparam={}}});var IBizToolbar=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.items=[];b.toolbar=$("#"+b.getId());if(b.toolbar){b.toolbar.find(".ibiz-toolbar-item").each(function(c,d){var f=$(this);if(!f.hasClass("ibiz-id-dropdown")){b.items.push(f);f.click(function(g){var h={};h.tag=$(this).attr("data-ibiz-tag");b.itemclick(h,g)})}});b.toolbar.find(".ibiz-id-dropdown").each(function(d,f){var g=$(this);b.items.push(g);var c=g.attr("data-ibiz-tag");g.find(".ibiz-id-item").click(function(j){var h=$(this).attr("data-ibiz-tag");var k={};k.itemtag=h;k.tag=c;k.obj=g;b.itemclick(k)})})}},updateAccAction:function(b){var a=this;$.each(a.items,function(c,f){var d=$(f).attr("data-ibiz-priv");if(d){if(b!=undefined&&b[d]!=undefined&&b[d]!=1){f.addClass("hide");return true}}f.removeClass("hide")})},itemclick:function(c,b){var a=this;a.fireEvent(IBizToolbar.ITEMCLICK,a,c)}});IBizToolbar.ITEMCLICK="ITEMCLICK";var IBizDataGrid=IBizControl.extend({construct:function(a){var b=this;arguments.callee.$.construct.call(this,a);b.grid=$("#"+a.id);if(b.grid){b.grid.bootstrapTable({striped:false,showRefresh:false,showToggle:false,showColumns:false,showExport:false,detailView:false,height:b.getHeight(),showPaginationSwitch:false,url:b.config.url,formatSearch:function(){return"请输入关键字"},queryParams:function(c){b.fireEvent(IBizDataGrid.BEFORELOAD,b,c);c.srfrender="BOOTSTRAPTABLE";return c},onLoadSuccess:function(c){return true},onAjaxSuccess:function(d){b.fireEvent(IBizDataGrid.LOADED,b,d);var c={};c.total=d.totalrow;c.rows=d.items;c.limit=d.limit;c.start=d.startrow;return c},onDblClickRow:function(d,c){b.fireEvent(IBizDataGrid.ROWDBLCLICK,b,d);return true},onLoadError:function(c){return false},columns:b.config.columns});this.grid.on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){b.fireEvent(IBizDataGrid.SELECTIONCHANGE,b,b.grid.bootstrapTable("getSelections"))})}},getHeight:function(){return 600},remove:function(a){var b=this;if(!a){a={}}$.extend(a,{srfaction:"remove"});if(IBizApp_Data){a.srfappdata=IBizApp_Data}IBiz.ajax({url:b.config.url,params:a,method:"POST",dataType:"json",success:function(c){if(c.ret==0){b.refresh();if(c.info&&c.info!=""){IBiz.alert("删除成功,"+c.info)}IBiz.processResult(c)}else{IBiz.alert("删除失败,"+c.info)}},failure:function(c){IBiz.alert("执行请求异常")}})},load:function(){var a=this;a.refresh()},refresh:function(){var a=this;a.grid.bootstrapTable("refresh")},getStore:function(){return null},setSelection:function(a){},getSelection:function(){if(this.grid){return this.grid.bootstrapTable("getSelections")}return null},doUIAction:function(b){var a=this;if(!b){b={}}$.extend(b,{srfaction:"uiaction"});if(IBizApp_Data){b.srfappdata=IBizApp_Data}IBiz.ajax({url:a.config.url,params:b,method:"POST",dataType:"json",success:function(c){if(c.ret==0){if(c.reloadData){a.refresh()}if(c.info&&c.info!=""){IBiz.alert("操作成功,"+c.info)}IBiz.processResult(c)}else{IBiz.alert("操作失败,执行操作发生错误，"+c.info)}},failure:function(c){IBiz.alert("执行请求异常")}})},wfsubmit:function(b){var a=this;if(!b){b={}}$.extend(b,{srfaction:"wfsubmit"});if(IBizApp_Data){b.srfappdata=IBizApp_Data}IBiz.ajax({url:a.config.url,params:b,method:"POST",dataType:"json",success:function(c){if(c.ret==0){a.refresh()}else{IBiz.alert("执行工作流操作失败，"+c.info)}},failure:function(c){IBiz.alert("执行请求异常")}})},addBatch:function(a){var b=this;if(!a){a={}}$.extend(a,{srfaction:"addbatch"});if(IBizApp_Data){a.srfappdata=IBizApp_Data}IBiz.ajax({url:b.config.url,params:a,method:"POST",dataType:"json",success:function(c){if(c.ret==0){b.refresh()}else{IBiz.alert("执行批量添加失败，"+c.info)}},failure:function(c){IBiz.alert("执行批量添加失败,请求异常")}})}});IBizDataGrid.SELECTIONCHANGE="SELECTIONCHANGE";IBizDataGrid.ROWDBLCLICK="ROWDBLCLICK";IBizDataGrid.BEFORELOAD="BEFORELOAD";IBizDataGrid.LOADED="LOADED";var IBizDataGrid2=IBizControl.extend({construct:function(a){var c=this;arguments.callee.$.construct.call(this,a);c.grid=$("#"+a.id);c.grid.addClass("ibiz-jq-datatable");c.tableselection=null;c.tableselections={};c.multiSelect=true;if(a.multiSelect!=undefined&&a.multiSelect==false){c.multiSelect=false}c.forceFit=false;if(a.forceFit!=undefined&&a.forceFit==true){c.forceFit=true}c.enablePaging=true;if(a.enablePaging!=undefined){c.enablePaging=a.enablePaging}c.pageSize=10;if(a.pageSize&&a.pageSize>0){c.pageSize=a.pageSize}var b=[];if(c.multiSelect){b.push({sTitle:'<input class="ibiz-id-checkall" type="checkbox"></input>',width:28,orderable:false,sortable:false,render:function(f,d,g){return'<input class="ibiz-id-check" type="checkbox" style="margin-left:2px;width:24px;"></input>'}})}b=b.concat(c.config.columns);if(c.grid){c.table=c.grid.dataTable({processing:true,serverSide:true,searching:false,bPaginate:c.enablePaging,bLengthChange:false,bProcessing:false,iDisplayLength:c.pageSize,order:[],ajax:{url:c.config.url,type:"POST",data:function(g,f){if(f&&f.jqXHR){try{f.jqXHR.abort();delete f.jqXHR}catch(d){}f.jqXHR=null}c.fireEvent(IBizDataGrid2.BEFORELOAD,c,g);g.offset=g.start;g.limit=g.length;c.datastart=g.start;c.datalimit=g.limit;if(g.limit<0){g.limit=1000;g.length=1000}g.srfrender="JQUERYDATATABLES";c.loadingTag=IBiz.beginload()},dataSrc:function(d){IBiz.endload(c.loadingTag);if(d.ret==0){c.tableselections={};setTimeout(function(){c.fireEvent(IBizDataGrid2.LOADED,c,d)},1);if(d.items){c.alldata=d.items;return d.items}}else{IBiz.alert("","加载数据发生错误，"+d.info,2)}c.alldata=[];return[]}},scrollY:c.getHeight(),scrollX:!c.forceFit,columns:b,rowCallback:function(f,d){f.ibizdata=d;if(c.tableselections[d.srfkey]){$(f).find(".ibiz-id-check").prop("checked",true);$(f).addClass("selected")}$(f).find(".ibiz-id-check").change(function(g){$(f).toggleClass("selected");if($(this).prop("checked")==true){c.tableselection=f.ibizdata;c.tableselections[d.srfkey]=d}else{delete c.tableselections[d.srfkey]}c.fireEvent(IBizDataGrid.SELECTIONCHANGE,c,c.getSelection())})},fnDrawCallback:function(d){if(c.config.hideHeader&&c.config.hideHeader==true){$(d.nTHead).hide()}if(c.enablePaging==false){$(".dataTables_info").hide()}}})}$("#"+c.config.id+"_wrapper .ibiz-id-checkall").change(function(f){var d=false;if($(this).prop("checked")==true){c.table.find(".ibiz-id-check").prop("checked",true);c.tableselection=null;c.table.find("tr").each(function(g,h){$(this).addClass("selected");if(this.ibizdata){c.tableselections[this.ibizdata.srfkey]=this.ibizdata;c.tableselection=this.ibizdata}})}else{c.table.find("tr").removeClass("selected");c.table.find(".ibiz-id-check").prop("checked",false);c.tableselection=null;c.tableselections={}}c.fireEvent(IBizDataGrid.SELECTIONCHANGE,c,c.getSelection())});c.grid.find("tbody").on("click","tr",function(d){if(d.target.localName=="input"||d.target.className=="ibiz-id-check"){return}c.table.$("tr.selected").removeClass("selected");c.table.find(".ibiz-id-check").prop("checked",false);$(this).addClass("selected");$(this).find(".ibiz-id-check").prop("checked",true);$("#"+c.config.id+"_wrapper .ibiz-id-checkall").prop("checked",false);if(c.tableselection&&c.tableselection.srfkey==this.ibizdata.srfkey){return}c.tableselection=this.ibizdata;c.tableselections={};c.tableselections[this.ibizdata.srfkey]=this.ibizdata;c.fireEvent(IBizDataGrid.SELECTIONCHANGE,c,c.getSelection())});c.grid.find("tbody").on("dblclick","tr",function(d){if(d.target.localName=="input"||d.target.className=="ibiz-id-check"){return}c.fireEvent(IBizDataGrid.ROWDBLCLICK,c,this.ibizdata)})},setSize:function(c,a){var f=this;f.layoutHeight=a;f.layoutWidth=c;var d=a;if(!(f.config.hideHeader==true)){d-=50}if(f.enablePaging==true){d-=50}var b=$("#"+f.config.id+"_wrapper .dataTables_scrollBody");b.height(d);f.grid.dataTable().fnAdjustColumnSizing(false)},getAllData:function(){var a=this;return a.alldata},getHeight:function(){var a=this;if(a.layoutHeight&&a.layoutHeight>0){return a.layoutHeight}if(a.config.height&&a.config.height>0){return a.config.height}return 0},remove:function(a){var b=this;if(!a){a={}}$.extend(a,{srfaction:"remove"});if(IBizApp_Data){a.srfappdata=IBizApp_Data}b.loadingTag=IBiz.beginload();IBiz.ajax({url:b.config.url,params:a,method:"POST",dataType:"json",success:function(c){IBiz.endload(b.loadingTag);if(c.ret==0){b.tableselection=null;b.tableselections={};b.refresh();if(c.info&&c.info!=""){IBiz.alert("","删除成功,"+c.info,1)}IBiz.processResult(c)}else{IBiz.alert("","删除失败,"+c.info,2)}},failure:function(c){IBiz.endload(b.loadingTag);IBiz.alert("","执行请求异常",2)}})},load:function(){var a=this;a.grid.dataTable().fnPageChange("first",true)},refresh:function(){var a=this;a.grid.dataTable().fnDraw(false);a.grid.dataTable().fnAdjustColumnSizing(false)},getStore:function(){return null},setSelection:function(a){var b=this;b.tableselections={};b.tableselection=null;if(a){table=b.grid.dataTable();table.find("tr").each(function(c,d){if(this.ibizdata){if(this.ibizdata.srfkey==a.srfkey){b.tableselections[this.ibizdata.srfkey]=this.ibizdata;b.tableselection=this.ibizdata;$(this).addClass("selected");$(this).find(".ibiz-id-check").prop("checked",true)}else{$(this).removeClass("selected");$(this).find(".ibiz-id-check").prop("checked",false)}}})}b.fireEvent(IBizDataGrid.SELECTIONCHANGE,b,b.getSelection())},getSelection:function(){var a=this;if(a.tableselections){var b=[];$.each(a.tableselections,function(c,d){b.push(d)});return b}return[]},doUIAction:function(b){var a=this;if(!b){b={}}$.extend(b,{srfaction:"uiaction"});if(IBizApp_Data){b.srfappdata=IBizApp_Data}a.loadingTag=IBiz.beginload();IBiz.ajax({url:a.config.url,params:b,method:"POST",dataType:"json",success:function(c){IBiz.endload(a.loadingTag);if(c.ret==0){if(c.reloadData){a.refresh()}if(c.info&&c.info!=""){IBiz.alert("","操作成功,"+c.info,1)}IBiz.processResult(c)}else{IBiz.alert("","操作失败,执行操作发生错误，"+c.info,2)}},failure:function(c){IBiz.endload(a.loadingTag);IBiz.alert("","执行请求异常",2)}})},wfsubmit:function(b){var a=this;if(!b){b={}}$.extend(b,{srfaction:"wfsubmit"});if(IBizApp_Data){b.srfappdata=IBizApp_Data}a.loadingTag=IBiz.beginload();IBiz.ajax({url:a.config.url,params:b,method:"POST",dataType:"json",success:function(c){IBiz.endload(a.loadingTag);if(c.ret==0){a.refresh()}else{IBiz.alert("","执行工作流操作失败，"+c.info,2)}},failure:function(c){IBiz.endload(a.loadingTag);IBiz.alert("","执行请求异常",2)}})},addBatch:function(a){var b=this;if(!a){a={}}$.extend(a,{srfaction:"addbatch"});if(IBizApp_Data){a.srfappdata=IBizApp_Data}b.loadingTag=IBiz.beginload();IBiz.ajax({url:b.config.url,params:a,method:"POST",dataType:"json",success:function(c){IBiz.endload(b.loadingTag);if(c.ret==0){b.refresh()}else{IBiz.alert("","执行批量添加失败，"+c.info,2)}},failure:function(c){IBiz.endload(b.loadingTag);IBiz.alert("","执行批量添加失败,请求异常",2)}})},exportData:function(b){var d=this;var h={};d.fireEvent(IBizDataGrid2.BEFORELOAD,d,h);h.query=h.search;h.srfaction="exportdata";var c=d.grid.dataTable().fnSettings();if(c&&c.aLastSort.length>0){var a=c.aoColumns[c.aLastSort[0].col];if(a){h.sort=a.data;h.sortdir=c.aLastSort[0].dir}}if(b.itemtag=="all"){h.start=0;h.limit=1000}else{if(b.itemtag=="custom"){var f=b.obj.find(".ibiz-id-start").val();var g=b.obj.find(".ibiz-id-end").val();if(f<1||g<1||f>g){IBiz.alert("警告","请输入有效的起始页",0);return}h.start=(f-1)*d.pageSize;h.limit=g*d.pageSize}else{h.start=d.datastart;h.limit=d.datalimit}}if(IBizApp_Data){h.srfappdata=IBizApp_Data}d.loadingTag=IBiz.beginload();IBiz.ajax({url:d.config.url,params:h,method:"POST",dataType:"json",success:function(k){IBiz.endload(d.loadingTag);if(k.ret==0){if(k.downloadurl){var j=BASEURL+k.downloadurl;IBiz.download(j)}}else{IBiz.alert("","导出数据失败，"+k.info,2)}},failure:function(j){IBiz.endload(d.loadingTag);IBiz.alert("","导出数据失败,请求异常",2)}})}});IBizDataGrid2.SELECTIONCHANGE="SELECTIONCHANGE";IBizDataGrid2.ROWDBLCLICK="ROWDBLCLICK";IBizDataGrid2.BEFORELOAD="BEFORELOAD";IBizDataGrid2.LOADED="LOADED";var IBizField=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.uniqueId=this.config.id;this.name=this.config.name;this.disabled=false;this.haserror=false;this.labeltext="";if(this.config.allowBlank!=undefined){this.allowBlank=this.config.allowBlank}else{this.allowBlank=true}if(this.config.hidden!=undefined){this.hidden=this.config.hidden}else{this.hidden=false}if(this.config.visible!=undefined){this.visible=this.config.visible}else{this.visible=true}this.label=$("#"+this.uniqueId+"__lb");this.container=$("#"+this.uniqueId+"__fi");if(this.label){this.labeltext=this.label.html()}},initSize:function(b){var a=this;if(a.config.width>0){b.width(a.config.width)}if(a.config.height>0){b.height(a.config.height)}},getFieldType:function(){return this.fieldType},setForm:function(a){this.form=a},getForm:function(){return this.form},getValue:function(){var a=this;return a.value},setValue:function(c){var b=this;var a=b.value;b.value=c;if(a!=c){b.onValueChanged(a,b.value)}},getUniqueId:function(){return this.uniqueId},getName:function(){return this.name},isDisabled:function(){return this.disabled},setDisabled:function(a){this.disabled=a;if(this.field){if(a){this.field.attr("readonly","readonly")}else{this.field.removeAttr("readonly")}this.field.prop("disabled",a)}},setHidden:function(a){this.hidden=a;if(this.label){if(a){this.label.addClass("hidden")}else{this.label.removeClass("hidden")}}if(this.field){if(a){this.field.addClass("hidden")}else{this.field.removeClass("hidden")}}},setVisible:function(a){this.visible=a;if(this.container){if(a){this.container.removeClass("hidden")}else{this.container.addClass("hidden")}}},setAsyncConfig:function(a){},setReadOnly:function(a){this.setDisabled(a)},setAllowBlank:function(a){if(this.label){if(a){this.label.html(this.labeltext)}else{this.label.html('<span class="text-danger">*</span>'+this.labeltext)}}},markInvalid:function(a){this.haserror=true;if(this.container){this.container.addClass("has-error")}},setActiveError:function(a){this.markInvalid(a)},hasActiveError:function(){return this.haserror},unsetActiveError:function(){this.haserror=false;if(this.container){this.container.removeClass("has-error")}},onValueChanged:function(a,b){this.fireEvent(IBizField.VALUECHANGED,this,{newvalue:b,oldvalue:a})}});IBizField.VALUECHANGED="VALUECHANGED";var IBizOfficeField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+b.getUniqueId());b.field.attr("src",BASEURL+"/weboffice/officeeditpage.jsp");b.field.load(function(){b.onIframeLoaded()});if(a.height>0){b.field.height(a.height)}if(a.width>0){b.field.width(a.width)}else{b.field.width("100%")}},onIframeLoaded:function(){var c=this;var b=c.getValue();c.frameobj=c.field[0].contentWindow;if(c.frameobj){c.frameobj.init(this);c.frameobj.setFileReadOnly(c.isDisabled());if(c.getForm()!=null){var a=c.getForm().getController();var d=a.viewparam.srfactivedata;if(d){if(c.frameobj.setActiveData){c.frameobj.setActiveData($.parseJSON(d))}}}c.frameobj.setValue(b)}},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;if(b.frameobj){b.frameobj.setFileReadOnly(a)}},onValueChanged:function(a,b){arguments.callee.$.onValueChanged.call(this,a,b);var c=this;if(c.frameobj){c.frameobj.setValue(b)}},getValue:function(){var a=this;if(a.frameobj){return a.frameobj.getValue()}return arguments.callee.$.getValue.call(this)}});var IBizFormGroup=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+b.getUniqueId())},setDisabled:function(a){var b=this;b.disabled=a},setHidden:function(b){var a=this;a.hidden=b;if(a.field){if(b){a.field.addClass("hidden")}else{a.field.removeClass("hidden")}}},setVisible:function(a){this.visible=a;if(this.field){if(a){this.field.removeClass("hidden")}else{this.field.addClass("hidden")}}}});var IBizFormTabPanel=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a)}});var IBizHiddenField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.fieldType="hiddenfield";this.field=$("#"+this.getUniqueId())},onValueChanged:function(a,c){var b=this;b.field.val(c);arguments.callee.$.onValueChanged.call(b,a,c)}});var IBizRawField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.field=$("#"+this.getUniqueId())},onValueChanged:function(a,c){var b=this;b.field.html(c);arguments.callee.$.onValueChanged.call(b,a,c)}});var IBizHtmlField=IBizField.extend({construct:function(b){arguments.callee.$.construct.call(this,b);var c=this;c.field=$("#"+c.getUniqueId());var a=b.height;if(!a||a<0){a=100}c.field.parent().css("height","");c.initSize(c.field);if(c.field){c.field.summernote({height:a,lang:"zh-CN",defaultFontName:"微软雅黑",fontNames:["微软雅黑","宋体","仿宋","黑体","楷体","隶书","新宋体","幼圆"],onChange:function(f,d){c.ignore=true;c.setValue(f);c.ignore=false}})}},setDisabled:function(a){var b=this;b.disabled=a;if(b.container){b.container.find(".note-editable").each(function(c,d){$(d).attr("contentEditable",!a)})}},onValueChanged:function(a,b){arguments.callee.$.onValueChanged.call(this,a,b);var c=this;if(c.ignore){return}c.field.code(b)}});var IBizListField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a)}});var IBizPickerField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+this.getUniqueId());b.initSize(b.field.parent());b.initSize(b.field);if(a.pageSize>0){b.pageSize=a.pageSize}else{b.pageSize=50}if(a.minChars>0){b.minChars=a.minChars}else{b.minChars=2}b.valueItem=this.config.valueItem;b.srftext="";b.srfvalue="";if(b.config.pickupView){b.pickermode=true}else{b.pickermode=false}b.field.parent().autocomplete({type:"POST",minChars:b.minChars,serviceUrl:function(){return b.config.url+"&srfaction=itemfetch"},onSelect:function(c){b.onSelectValue(c.data,c.value)},onSearchStart:function(f){var c={srfaction:"itemfetch"};var d=b.fillPickupCondition(c);if(d==false){return false}f=$.extend(f,c);f.limit=b.pageSize;return true},onACClosed:function(c){if(b.field.val()==""){b.onSelectValue("","");return}if(b.field.val()!=b.value){b.field.val(b.value)}},onToggleClick:function(c){if(b.pickermode){b.openPickView()}else{c.getSuggestions("")}},transformResult:function(d){var f=(typeof d==="string"?$.parseJSON(d):d);var c=[];if(f.ret==0){$.each(f.items,function(g,h){var k=h.text?h.text.toString():"未定义";var j=h.value?h.value.toString():"";c.push({value:k,data:j})})}if(c.length==0&&b.pickermode==true){c.push({value:"找不到符合的数据",data:""})}return{suggestions:c}}})},onSelectValue:function(c,b){var a=this;if(!c||c==""){c="";b=""}a.getForm().setFieldValue(a.valueItem,c);a.setValue(b)},onValueChanged:function(a,c){var b=this;b.field.val(c);arguments.callee.$.onValueChanged.call(b,a,c)},pickerWindowClose:function(b){var a=this;if(b.dialogResult=="ok"){if(b.selectedData){a.onSelectValue(b.selectedData.srfkey,b.selectedData.srfmajortext)}}else{if(b.dialogResult=="reset"){a.onSelectValue("","")}}},openPickView:function(){var b=this;if(b.isDisabled()){return}var d=$.getIBizApp().createWindow({});var a={srfaction:"itemfetch"};var c=b.fillPickupCondition(a);if(c==false){return}a.windowid=d.getId();d.scope=b;d.title=b.config.pickupView.title;d.height=b.config.pickupView.height;d.width=b.config.pickupView.width;d.url=$.getIBizApp().parseURL(BASEURL,b.config.pickupView.view,{windowid:d.getId()});d.viewparam=a;d.callback=function(f){b.pickerWindowClose(f)};d.openModal(window)},fillPickupCondition:function(o){var h=this;var a=h.getForm();if(!a){IBiz.alert("","未能找到当前表单，无法继续操作",2);return false}if(h.config.itemParam&&h.config.itemParam.fetchcond){var k={};var c=h.config.itemParam.fetchcond;for(var j in c){var l=a.findField(c[j]);if(!l){IBiz.alert("未能找到表单项["+c[j]+"]，无法继续操作");return false}var m=l.getValue();if(m==null||m==""){return false}k[j]=m}o.srffetchcond=JSON.stringify(k)}if(h.config.itemParam&&h.config.itemParam.temprs){if(a.tempMode){o.srftempmode=true}}if(IBizApp_Data){o.srfappdata=IBizApp_Data}o.srfreferitem=h.config.name;var b=a.getFormType();if(b=="EDITFORM"){var n=a.getActiveData();o.srfreferdata=JSON.stringify(n)}else{if(b=="SEARCHFORM"){var f=h.getForm().getController();var d=f.getReferData();if(d){o.srfreferdata=JSON.stringify(d)}if(!o.srfreferdata){var g=f.getParentData();if(g){o.srfparentdata=JSON.stringify(g)}}}}return true}});var IBizRadioField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+this.getUniqueId());b.items={};b.initEvents();b.itemWidth=a.itemWidth;if(b.itemWidth==undefined){b.itemWidth=150}},onValueChanged:function(a,d){var c=this;$.each(this.items,function(g,f){f.parent().removeClass("checked");f.removeAttr("checked")});var b=this.items[d];if(b){b.parent().addClass("checked");b.attr("checked","checked")}arguments.callee.$.onValueChanged.call(c,a,d)},initEvents:function(){var a=this;a.items={};if(a.field){a.field.find("input").each(function(b,d){var c=$(d);a.items[d.value]=c;c.prop("disabled",a.disabled);c.change(function(f){if(a.isDisabled()){return}a.setValue(f.target.value)})})}},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;$.each(b.items,function(c,d){d.prop("disabled",b.disabled)})},setAsyncConfig:function(b){var c=this;var a=[];if(b&&b.items){$.each(b.items,function(d,f){a.push('<label class="radio-inline" style="width:'+c.itemWidth.toString()+'px;">');a.push('<div class="radio">');a.push('<span class="">');a.push('<input type="radio" value="'+f.value+'">');a.push("</span>");a.push("</div>");a.push(f.text);a.push("</label>")})}c.field.html(a.join(""));c.initEvents();c.onValueChanged(c.value,c.value)}});var IBizSpanField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.fieldType="displayfield";b.field=$("#"+b.getUniqueId());b.initSize(b.field)},onValueChanged:function(a,c){var b=this;b.field.val(c);arguments.callee.$.onValueChanged.call(b,a,c)}});var IBizTextAreaField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.itemMap={};b.field=$("#"+b.getUniqueId());b.field.change(b,function(d){var c=d.data;c.setValue(c.field.val())});b.menucontainer=$("#"+b.getUniqueId()+"_c").find(".ibiz-id-dropdownmenu");b.dropdownbtn=$("#"+b.getUniqueId()+"_c").find(".dropdown-toggle");b.initSize(b.field);if(!a.dictId){b.menucontainer.addClass("hide");b.dropdownbtn.addClass("hide")}$("#"+b.getUniqueId()).autotextarea({})},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;if(b.dropdownbtn){b.dropdownbtn.prop("disabled",a);b.dropdownbtn.attr("disabled",a)}},onValueChanged:function(a,c){var b=this;b.field.val(c);$("#"+b.getUniqueId()).autotextarea2({minHeight:b.config.height?b.config.height:34});arguments.callee.$.onValueChanged.call(b,a,c)},setAsyncConfig:function(b){var c=this;if(c.menucontainer){var a=[];if(b&&b.dictitems){$.each(b.dictitems,function(d,f){c.itemMap[f.value]=f;a.push('<li><a class="ibiz-id-menuitem" href="javascript:void(0);" data-ibiz-id="'+f.value+'">');a.push(f.text);a.push("</a></li>")})}c.menucontainer.html(a.join(""));c.initEvents()}},initEvents:function(){var a=this;if(a.menucontainer){a.menucontainer.find(".ibiz-id-menuitem").click(function(b){var c=a.itemMap[$(this).attr("data-ibiz-id")].value;a.field.insertAtCaret(c);a.setValue(a.field.val())})}}});var IBizDateField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.fmt=a.fmt;if(!b.fmt){b.fmt="YYYY-MM-DD HH:mm"}b.field=$("#"+b.getUniqueId());b.initSize(b.field);b.field.datetimepicker({locale:"zh_cn",format:b.fmt});b.field.on("dp.change",b,function(d){var c=d.data;if(d.date===false){c.setValue("")}else{c.setValue(moment(d.date).format(c.fmt))}});b.field.on("dp.show",b,function(d){var c=d.data;c.onShowHideChanged(true)});b.field.on("dp.hide",b,function(d){var c=d.data;c.onShowHideChanged(false)})},onValueChanged:function(a,b){var c=this;if(!b||b==""){c.field.val("")}else{c.field.val(b)}arguments.callee.$.onValueChanged.call(this,a,b)},onShowHideChanged:function(a){var b=this;if(!b.getForm()){return}var c=b.getForm().getFormType();if(c=="SEARCHFORM"){if(a){$("#"+b.getUniqueId()+"_c").css("height","400px")}else{$("#"+b.getUniqueId()+"_c").css("height","")}}}});var IBizTextField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+b.getUniqueId());b.field.change(b,function(d){var c=d.data;c.setValue(c.field.val())});b.initSize(b.field)},onValueChanged:function(a,c){var b=this;b.field.val(c);arguments.callee.$.onValueChanged.call(b,a,c)}});var IBizFileField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+this.getUniqueId());b.containerEL=b.field.find(".ibiz-fileupload-container");b.container=$(b.containerEL);b.uploadbtnEL=b.field.find(".ibiz-fileupload-upload");b.uploadbtn=$(b.uploadbtnEL);b.uploadbtn.click(function(){b.openUploadView("")});b.initSize(b.field);b.field.find(".select2-container").css("cssText","height:100%!important");b.field.find(".select2-choices").css("cssText","height:100%!important")},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;if(b.uploadbtn){b.uploadbtn.prop("disabled",a);b.uploadbtn.attr("disabled",a)}},getValue:function(){if(this.value){try{if(this.value.length==0){return""}}catch(a){}return JSON.stringify(this.value)}return""},setValue:function(c){var b=this;if(c&&c!==""){if(typeof(c)!=="object"){try{c=JSON.parse(c)}catch(d){c=[]}}}else{c=[]}var a=b.value;b.value=c;b.render(b.value);if(a!=c){b.onValueChanged(a,b.value)}},render:function(c){var b=this;if(c){var a=[];$.each(c,function(d,f){var j=f.id;var h=f.name;var g='<li data-ibiz-fileid="'+j+'" class="ibiz-fileupload-item select2-search-choice ms-hover">';g+="<div>"+h+"</div>";g+='<a href="#" class="ibiz-fileupload-remove select2-search-choice-close" tabindex="-1"></a>';g+="</li>";a.push(g)});b.container.html(a.join(""));b.container.find(".ibiz-fileupload-remove").each(function(d,f){$(f).click(function(){b.removeFile($(this).parent().attr("data-ibiz-fileid"))})});b.container.find(".ibiz-fileupload-item").each(function(d,f){$(f).dblclick(function(){b.openFile($(this).attr("data-ibiz-fileid"))})})}else{b.container.html("")}},removeFile:function(c){var b=this;if(b.isDisabled()){return}var a=[];if(b.value){$.each(b.value,function(d,f){if(f.id!=c){a.push(f)}})}b.setValue(a)},openFile:function(a){window.open(BASEURL+"/ibizutil/exportfile.jsp?fileid="+a,"_blank")},uploadCallback:function(d){var b=d.opener;var c=d.files;if(c){if(b.value){var a=$.merge(b.value,c);b.setValue(a)}else{b.setValue(c)}}},openUploadView:function(c){var a=this;if(a.isDisabled()){return}var b=$.getIBizApp().createWindow({});b.opener=a;b.title="上传文件";b.height=500;b.width=600;b.url=BASEURL+"/ibizutil/fileuploadview.jsp?"+$.param({windowid:b.getId()});b.callback=a.uploadCallback;b.openModal(window)}});var IBizDropDownListField=IBizField.extend({construct:function(b){arguments.callee.$.construct.call(this,b);var a=this;a.field=$("#"+this.getUniqueId());if(a.field){a.field.select2({placeholder:"请选择..."});a.field.on("change",a,function(d){var c=$(d.target).select2("val");if(c=="__SRFRESET__"){d.data.setValue("");$(d.target).select2("val","");return}d.data.setValue($(d.target).select2("val"))})}},onValueChanged:function(a,c){var b=this;if(b.field){b.field.select2("val",c)}arguments.callee.$.onValueChanged.call(this,a,c)},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;if(b.field){b.field.prop("disabled",a)}},setAsyncConfig:function(b){var c=this;var a=[];if(b&&b.items){a.push('<option value="__SRFRESET__">(清空)</option>');$.each(b.items,function(d,f){a.push('<option value="'+f.value+'">'+f.text+"</option>")})}if(c.field){c.field.html(a.join(""))}c.onValueChanged(c.value,c.value)}});var IBizCheckField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.field=$("#"+this.getUniqueId());var b=this;this.field.change(function(c){if(b.field.is(":checked")){b.setValue("1")}else{b.setValue("0")}})},onValueChanged:function(a,c){var b=this;if(c=="1"){b.field.attr("checked",true)}else{b.field.attr("checked",false)}arguments.callee.$.onValueChanged.call(this,a,c)}});var IBizCheckListField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+this.getUniqueId());b.items={};b.initEvents();b.itemWidth=a.itemWidth;b.orMode=a.orMode;b.valueSeparator=a.valueSeparator;if(b.itemWidth==undefined){b.itemWidth=150}if(b.orMode==undefined||b.orMode==""){b.orMode="str"}if(b.orMode=="str"&&(b.valueSeparator==undefined||b.valueSeparator=="")){b.valueSeparator=","}},onValueChanged:function(b,f){var d=this;$.each(d.items,function(g,h){$(h).parent().removeClass("checked");$(h).prop("checked",false)});if(f){if(d.orMode=="num"){var c=parseInt(f);$.each(d.items,function(h,j){var g=parseInt(h);if((c&g)==g){$(j).parent().addClass("checked");$(j).prop("checked",true)}})}else{if(d.orMode=="str"){var a=f.split(d.valueSeparator);$.each(a,function(g,j){var h=d.items[j];if(h){$(h).parent().addClass("checked");$(h).prop("checked",true)}})}}}arguments.callee.$.onValueChanged.call(d,b,f)},initEvents:function(){var a=this;a.items={};if(a.field){a.field.find("input").each(function(b,d){var c=$(d);a.items[d.value]=c;c.prop("disabled",a.disabled);c.change(function(h){if(a.isDisabled()){return}if(h.target.checked){$(h.target).parent().addClass("checked")}else{$(h.target).parent().removeClass("checked")}if(a.orMode=="num"){var g=0;$.each(a.items,function(j,k){if($(k).parent().hasClass("checked")){g=g|parseInt(j)}});a.setValue(g.toString())}else{if(a.orMode=="str"){var f=[];$.each(a.items,function(j,k){if($(k).parent().hasClass("checked")){f.push(j)}});a.setValue(f.join(a.valueSeparator))}}})})}},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;$.each(b.items,function(c,d){d.prop("disabled",b.disabled)})},setAsyncConfig:function(b){var c=this;var a=[];if(b&&b.items){$.each(b.items,function(d,f){a.push('<label class="checkbox-inline" style="width:'+c.itemWidth.toString()+'px;">');a.push('<div class="checker">');a.push('<span class="">');a.push('<input type="checkbox" value="'+f.value+'">');a.push("</span>");a.push("</div>");a.push(f.text);a.push("</label>")})}c.field.html(a.join(""));c.initEvents();c.onValueChanged(c.value,c.value)}});var IBizCheckListField2=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.itemMap={};b.field=$("#"+b.getUniqueId());b.initSize(b.field);b.field.change(function(){b.setValue(b.field.val())})},initData:function(a){var b=this;if(!a){a=[]}$.each(a,function(c,d){b.itemMap[d.value]=d});b.field.select2({tags:a,id:function(c){return c.value}});b.field.parent().find(".select2-container").css("cssText","height:100%!important");b.field.parent().find(".select2-choices").css("cssText","height:100%!important")},onValueChanged:function(b,f){var d=this;var a=[];if(f){var c=f.split(",");$.each(c,function(h,j){var g="未知";var k=d.itemMap[j];if(k){g=k.text}a.push({value:j,text:g})})}d.field.select2("data",a);arguments.callee.$.onValueChanged.call(d,b,f)},setAsyncConfig:function(b){var c=this;var a=[];if(b&&b.items){c.initData(b.items)}else{c.initData([])}c.onValueChanged(c.value,c.value)}});var IBizListPickerField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.itemMap={};b.field=$("#"+b.getUniqueId());if(b.container){b.addBtn=$(b.container.find(".ibiz-id-add"));b.removeBtn=$(b.container.find(".ibiz-id-remove"))}if(b.addBtn){b.addBtn.click(function(c){b.openPickView()})}if(b.removeBtn){b.removeBtn.click(function(c){b.deleteSelectItems()})}},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;if(b.addBtn){b.addBtn.prop("disabled",a);b.addBtn.attr("disabled",a)}if(b.removeBtn){b.removeBtn.prop("disabled",a);b.removeBtn.attr("disabled",a)}},onValueChanged:function(a,g){var c=this;var b=[];if(g==null||g==undefined||g==""){c.itemMap={}}else{var d=[];try{d=JSON.parse(g)}catch(f){}$.each(d,function(h,j){b.push('<option value="'+j.srfkey+'">'+j.srfmajortext+"</option>");c.itemMap[j.srfkey]=j})}c.field.html(b.join(""));arguments.callee.$.onValueChanged.call(this,a,g)},deleteSelectItems:function(){var c=this;if(c.isDisabled()){return}var b=c.field.val();if(b==null||b==undefined||b==""){return}var a;$.each(b,function(f,g){if(c.itemMap[g]){delete c.itemMap[g];a=true}});if(a){var d=[];$.each(c.itemMap,function(f,g){d.push(g)});if(d.length==0){c.setValue("")}else{c.setValue(JSON.stringify(d))}}},pickerWindowClose:function(d){var b=this;var a=false;if(d.dialogResult=="ok"){if(d.selectedDatas){$.each(d.selectedDatas,function(f,g){if(!b.itemMap[g.srfkey]){a=true;b.itemMap[g.srfkey]=g}})}}if(a){var c=[];$.each(b.itemMap,function(f,g){c.push(g)});if(c.length==0){b.setValue("")}else{b.setValue(JSON.stringify(c))}}},openPickView:function(){var b=this;if(b.isDisabled()){return}if(!b.config.pickupView){return}var c=$.getIBizApp().createWindow({});var a={};a.windowid=c.getId();c.scope=b;c.title=b.config.pickupView.title;c.height=b.config.pickupView.height;c.width=b.config.pickupView.width;c.url=$.getIBizApp().parseURL(BASEURL,b.config.pickupView.view,{windowid:c.getId()});c.viewparam=a;c.callback=function(d){b.pickerWindowClose(d)};c.openModal(window)}});var IBizAddressPickerField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.itemMap={};b.field=$("#"+this.getUniqueId());b.containerEL=b.field.find(".ibiz-id-container");b.container=$(b.containerEL);b.uploadbtn=b.field.find(".ibiz-id-picker");b.uploadbtn.click(function(){b.openPickView()});b.initSize(b.field);b.field.find(".select2-container").css("cssText","height:100%!important");b.field.find(".select2-choices").css("cssText","height:100%!important")},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;if(b.uploadbtn){b.uploadbtn.prop("disabled",a);b.uploadbtn.attr("disabled",a)}},onValueChanged:function(a,g){var c=this;var b=[];if(g==null||g==undefined||g==""){c.itemMap={}}else{var d=[];try{d=JSON.parse(g)}catch(f){}$.each(d,function(h,j){c.itemMap[j.srfkey]=j})}c.render();arguments.callee.$.onValueChanged.call(this,a,g)},render:function(){var b=this;if(b.itemMap){var a=[];$.each(b.itemMap,function(c,d){if(d){var g=d.srfkey;var f=d.srfmajortext;var d='<li data-id-item="'+g+'" class="ibiz-id-item select2-search-choice ms-hover">';d+="<div>"+f+"</div>";d+='<a href="#" class="ibiz-id-remove select2-search-choice-close" tabindex="-1"></a>';d+="</li>";a.push(d)}});b.container.html(a.join(""));b.container.find(".ibiz-id-remove").each(function(c,d){$(d).click(function(){b.removeItem($(this).parent().attr("data-id-item"))})})}else{b.container.html("")}},removeItem:function(c){var a=this;if(a.isDisabled()){return}a.itemMap[c]=null;var b=[];$.each(a.itemMap,function(d,f){if(f){b.push(f)}});if(b.length==0){a.setValue("")}else{a.setValue(JSON.stringify(b))}},openPickView:function(){var b=this;if(b.isDisabled()){return}if(!b.config.pickupView){return}var c=$.getIBizApp().createWindow({});var a={};a.windowid=c.getId();c.scope=b;c.title=b.config.pickupView.title;c.height=b.config.pickupView.height;c.width=b.config.pickupView.width;c.url=$.getIBizApp().parseURL(BASEURL,b.config.pickupView.view,{windowid:c.getId()});c.viewparam=a;c.callback=function(d){b.pickerWindowClose(d)};c.openModal(window)},pickerWindowClose:function(d){var b=this;var a=false;if(d.dialogResult=="ok"){if(d.selectedDatas){$.each(d.selectedDatas,function(f,g){if(!b.itemMap[g.srfkey]){a=true;b.itemMap[g.srfkey]=g}})}}if(a){var c=[];$.each(b.itemMap,function(f,g){if(g){c.push(g)}});if(c.length==0){b.setValue("")}else{b.setValue(JSON.stringify(c))}}}});var IBizForm=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.id=this.config.id;this.backendurl=this.config.url;this.controller=a.ctrler;this.fieldIdMap={};this.fieldMap={}},init:function(){var a=this;$.each(a.fieldMap,function(b,c){c.setAllowBlank(c.allowBlank);c.setVisible(c.visible);c.setHidden(c.hidden)})},autoLoad:function(a){var b=this;if(!a){a={}}if(a.srfkey!=undefined&&a.srfkey!=""){b.load2(a);return}if(a.srfkeys!=undefined&&a.srfkeys!=""){a.srfkey=a.srfkeys;b.load2(a);return}b.loadDraft(a)},load2:function(a){var b=this;if(!a){a={}}if(IBizApp_Data){a.srfappdata=IBizApp_Data}$.extend(a,{srfaction:"load"});b.ignoreUFI=true;b.ignoreformfieldchange=true;b.load(a,function(c,d){b.setFieldAsyncConfig(d.config);b.setFieldState(d.state);b.setDataAccAction(d.dataaccaction);b.fillForm(d.data);b.formDirty=false;b.fireEvent(IBizForm.FORMLOADED,b);b.ignoreUFI=false;b.ignoreformfieldchange=false;b.fireEvent(IBizForm.FORMFIELDCHANGED,null);b.onLoaded()},function(c,d){d.failureType="SERVER_INVALID";IBiz.alert("","加载数据发生错误,"+b.getActionErrorInfo(d),2);b.ignoreUFI=false;b.ignoreformfieldchange=false})},loadDraft:function(a){var b=this;if(!a){a={}}b.ignoreUFI=true;b.ignoreformfieldchange=true;if(IBizApp_Data){a.srfappdata=IBizApp_Data}if(!a.srfsourcekey||a.srfsourcekey==""){$.extend(a,{srfaction:"loaddraft"})}else{$.extend(a,{srfaction:"loaddraftfrom"})}b.load(a,function(c,d){b.setFieldAsyncConfig(d.config);b.setFieldState(d.state);b.setDataAccAction(d.dataaccaction);b.fillForm(d.data);b.formDirty=false;b.fireEvent(IBizForm.FORMLOADED,b);b.ignoreUFI=false;b.ignoreformfieldchange=false;b.fireEvent(IBizForm.FORMFIELDCHANGED,null);b.onDraftLoaded()},function(c,d){d.failureType="SERVER_INVALID";IBiz.alert("","加载草稿发生错误,"+b.getActionErrorInfo(d),2);b.ignoreUFI=false;b.ignoreformfieldchange=false})},onDraftLoaded:function(){var a=this},onLoaded:function(){var a=this},setFieldAsyncConfig:function(a){if(a==undefined||a==null){return}var b=this;$.each(a,function(c,d){var f=b.findField(c);if(f){f.setAsyncConfig(d)}})},setDataAccAction:function(a){var b=this;b.dataaccaction=a;b.fireEvent(IBizForm.DATAACCACTIONCHANGE,b,a)},setFieldState:function(b){if(b==undefined||b==null){return}var a=this;$.each(b,function(c,f){var g=a.findField(c);if(g){var d=((f&1)==0);if(g.isDisabled()!=d){g.setDisabled(d)}}})},isDirty:function(){var a=this;return a.formDirty},register:function(b){var a=this;if($.isArray(b)){$.each(b,function(c,d){a.fieldIdMap[d.getName()]=d;a.fieldMap[d.getName()]=d;d.setForm(a);d.on(IBizField.VALUECHANGED,function(g,f,h){if(a.ignoreformfieldchange){return}a.formDirty=true;a.fireEvent(IBizForm.FORMFIELDCHANGED,g,f)},a)})}else{a.fieldIdMap[b.getName()]=b;a.fieldMap[b.getName()]=b;b.setForm(a);b.on(IBizField.VALUECHANGED,function(d,c,f){if(a.ignoreformfieldchange){return}a.formDirty=true;a.fireEvent(IBizForm.FORMFIELDCHANGED,d,c)},a)}},unRegister:function(a){this.fieldMap[a.getName()]=null;this.fieldIdMap[a.getUniqueId()]=null},getSRFCtrlId:function(){return this.srfctrlid},getBackendUrl:function(){return this.backendurl},findField:function(a){return this.fieldMap[a]},getFieldById:function(a){return this.fieldIdMap[a]},load:function(a,b,c){var d=this;if(!a){a={}}d.loadingTag=IBiz.beginload();IBiz.ajax({url:d.backendurl,params:a,method:"POST",success:function(f){IBiz.endload(d.loadingTag);if(f&&f.ret==0){b(d,f)}else{c(d,f)}},failure:function(f){IBiz.endload(d.loadingTag);c(d,f)}})},submit:function(a,d,b){var c=this;if(!a){a={}}c.loadingTag=IBiz.beginload();IBiz.ajax({url:this.backendurl,params:a,method:"POST",success:function(f){IBiz.endload(c.loadingTag);if(f.ret==0){d(c,f)}else{b(c,f)}},failure:function(f){IBiz.endload(c.loadingTag);b(c,{ret:1000,errorMessage:"请求发生错误"})}})},getActionErrorInfo:function(a){if(a.failureType==="CONNECT_FAILURE"){return"Status:"+a.response.status+": "+a.response.statusText}if(a.failureType==="SERVER_INVALID"){var b=a.errorMessage;if(a.error&&a.error.items){$.each(a.error.items,function(c,d){if(c>=5){b+=("<BR>...... ");return false}if(d.info&&d.info!=""){b+=("<BR>"+d.info)}})}return b}if(a.failureType==="CLIENT_INVALID"){return""}if(a.failureType==="LOAD_FAILURE"){return""}},fillForm:function(b){if(!b){return}var a=this;$.each(b,function(c,d){if($.isArray(d)){d=JSON.stringify(d)}a.setFieldValue(c,d)})},setFieldValue:function(a,b){var c=this.findField(a);if(c){c.setValue(b)}},getFieldValue:function(a){var b=this;var c=b.findField(a);if(!c){IBiz.alert("错误","无法获取表单项["+a+"]",2);return""}return c.getValue()},setFieldAllowBlank:function(a,c){var b=this;var d=b.findField(a);if(d){d.setAllowBlank(c)}},setFieldDisabled:function(a,b){var c=this;var d=c.findField(a);if(d){d.setDisabled(b)}},setFormError:function(b){var a=this;a.resetFormError();if(b&&b.items){$.each(b.items,function(c,d){var f=a.findField(d.id);if(f){f.markInvalid("输入有误");f.setActiveError("输入有误")}})}},resetFormError:function(){var a=this;$.each(a.fieldMap,function(b,c){if(c.hasActiveError()){c.unsetActiveError()}})},setPanelVisible:function(a,d){var b=this;var c=b.findField(a);if(c){c.setVisible(d)}},getActiveData:function(){var b=this;var a={};$.each(b.fieldMap,function(c,f){if(f){if(a[f.getName()]==undefined){var d=f.getValue();if(d){if(d.toString().length<8000){a[f.getName()]=f.getValue()}}}}});return a},getValues:function(){var b=this;var a={};$.each(b.fieldMap,function(d,f){var c=f.getName();var g=f.getValue();a[c]=g});return a},testFieldEnableReadonly:function(a){return false},updateFormItems:function(a){var b=this;if(b.ignoreUFI){return}var c=b.getActiveData();if(!a){a={}}if(IBizApp_Data){a.srfappdata=IBizApp_Data}$.extend(a,{srfaction:"updateformitem",srfactivedata:JSON.stringify(c)});b.ignoreUFI=true;b.ignoreformfieldchange=true;b.load(a,function(d,f){b.setFieldAsyncConfig(f.config);b.setFieldState(f.state);b.setDataAccAction(f.dataaccaction);b.fillForm(f.data);b.ignoreUFI=false;b.ignoreformfieldchange=false;b.fireEvent(IBizForm.FORMFIELDCHANGED,null)},function(d,f){f.failureType="SERVER_INVALID";IBiz.alert("","更新表单项发生错误"+f.info,2);b.ignoreUFI=false;b.ignoreformfieldchange=false})},reset:function(){var a=this;a.autoLoad()},getFormType:function(){return""}});IBizForm.FORMLOADED="FORMLOADED";IBizForm.FORMFIELDCHANGED="FORMFIELDCHANGED";IBizForm.FORMSAVED="FORMSAVED";IBizForm.FORMREMOVED="FORMREMOVED";IBizForm.FORMWFSTARTED="FORMWFSTARTED";IBizForm.FORMWFSUBMITTED="FORMWFSUBMITTED";IBizForm.DATAACCACTIONCHANGE="DATAACCACTIONCHANGE";var IBizSearchForm=IBizForm.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.container=$("#"+a.id);b.searchBtn=$("#"+a.id+"_searchbutton");b.resetBtn=$("#"+a.id+"_resetbutton");b.bResetting=false;if(b.searchBtn){if(b.getController().hasQuickSearch()){b.searchBtn.addClass("hidden")}else{b.searchBtn.click(b,function(c){c.data.onSearch()})}}if(b.resetBtn){b.resetBtn.click(b,function(c){c.data.onReset()})}b.container.find("input").keyup(function(){if(event.keyCode=="13"){b.onSearch()}});b.container.find("select").keyup(function(){if(event.keyCode=="13"){b.onSearch()}})},isOpen:function(){var a=this;return a.opened},open:function(){var a=this;a.opened=true;if(a.container){a.container.removeClass("hidden")}},close:function(){var a=this;a.opened=false;if(a.container){a.container.addClass("hidden")}},onSearch:function(){var a=this;a.fireEvent(IBizSearchForm.FORMSEARCHED,a,{})},onReset:function(){var a=this;a.bResetting=true;a.reset()},onDraftLoaded:function(){var a=this;a.fireEvent(IBizSearchForm.FORMRESETED,a,{})},onLoaded:function(){var a=this;a.fireEvent(IBizSearchForm.FORMRESETED,a,{})},getFormType:function(){return"SEARCHFORM"},getHeight:function(){var a=this;if(a.isOpen()){return a.container.outerHeight()}return 0}});IBizSearchForm.FORMRESETED="FORMRESETED";IBizSearchForm.FORMSEARCHED="FORMSEARCHED";var IBizEditForm=IBizForm.extend({construct:function(a){arguments.callee.$.construct.call(this,a)},save2:function(a){var b=this;if(!a){a={}}if(IBizApp_Data){a.srfappdata=IBizApp_Data}var c=this.getValues();$.extend(a,c);if(c.srfuf=="1"){$.extend(a,{srfaction:"update"})}else{$.extend(a,{srfaction:"create"})}var d={};$.each(this.fieldMap,function(f,g){if(g.isDisabled()){if(d[g.name]==undefined){d[g.name]=g.getValue()}}});$.extend(a,d);a.srfcancel=false;b.fireEvent(IBizEditForm.FORMBEFORESAVE,b,a);if(a.srfcancel==true){return}delete a.srfcancel;b.ignoreUFI=true;b.ignoreformfieldchange=true;this.submit(a,function(f,g){b.resetFormError();b.setFieldAsyncConfig(g.config);b.setFieldState(g.state);b.setDataAccAction(g.dataaccaction);b.fillForm(g.data);b.formDirty=false;b.fireEvent("formsaved",b);b.ignoreUFI=false;b.ignoreformfieldchange=false;b.fireEvent("formfieldchanged",null);b.onSaved()},function(f,g){if(g.error){b.setFormError(g.error)}b.ignoreUFI=false;b.ignoreformfieldchange=false;b.fireEvent(IBizEditForm.FORMSAVEERROR,b);g.failureType="SERVER_INVALID";if(g.ret==10){IBiz.confirm2("","保存数据发生错误,"+b.getActionErrorInfo(g)+",是否要重新加载数据？",2,function(h){if(h){b.reload()}})}else{IBiz.alert("","保存数据发生错误,"+b.getActionErrorInfo(g),2)}})},onSaved:function(){var a=this},reload:function(){var b=this;var c=b.findField("srfkey");var a={};if(c){a.srfkey=c.getValue();if(a.srfkey.indexOf("SRFTEMPKEY:")==0){c=b.findField("srforikey");if(c){a.srfkey=c.getValue()}}}b.autoLoad(a)},remove:function(a){var b=this;if(!a){a={}}if(IBizApp_Data){a.srfappdata=IBizApp_Data}if(!a.srfkey){var c=b.findField("srfkey");if(c){a.srfkey=c.getValue()}}if(a.srfkey==undefined||a.srfkey==null||a.srfkey==""){IBiz.alert("删除数据发生错误","当前表单未加载数据！",2);return}$.extend(a,{srfaction:"remove"});b.ignoreUFI=true;b.load(a,function(d,f){if(f.ret==0){b.setFieldAsyncConfig(f.config);b.setFieldState(f.state);b.fireEvent(IBizForm.FORMREMOVED)}b.ignoreUFI=false},function(d,f){f.failureType="SERVER_INVALID";IBiz.alert("","删除数据发生错误,"+b.getActionErrorInfo(f),2);b.ignoreUFI=false})},wfstart:function(a){var c=this;if(!a){a={}}if(IBizApp_Data){a.srfappdata=IBizApp_Data}if(!a.srfkey){var d=c.findField("srfkey");if(d){a.srfkey=d.getValue()}d=c.findField("srforikey");if(d){var b=d.getValue();if(b&&b!=""){a.srfkey=b}}}if(a.srfkey==undefined||a.srfkey==null||a.srfkey==""){IBiz.alert("启动流程发生错误","当前表单未加载数据！",2);return}$.extend(a,{srfaction:"wfstart"});c.ignoreUFI=true;c.ignoreformfieldchange=true;c.load(a,function(f,g){c.setFieldAsyncConfig(g.config);c.setFieldState(g.state);c.setDataAccAction(g.dataaccaction);c.fillForm(g.data);c.formDirty=false;c.fireEvent(IBizForm.FORMLOADED);c.fireEvent(IBizForm.FORMWFSTARTED);c.ignoreUFI=false;c.ignoreformfieldchange=false;c.fireEvent(IBizForm.FORMFIELDCHANGED,null)},function(f,g){g.failureType="SERVER_INVALID";IBiz.alert("","启动流程发生错误,"+c.getActionErrorInfo(g),2);c.ignoreUFI=false;c.ignoreformfieldchange=false})},wfsubmit:function(a){var b=this;if(!a){a={}}if(IBizApp_Data){a.srfappdata=IBizApp_Data}var c=b.getValues();$.extend(a,c);$.extend(a,{srfaction:"wfsubmit"});if(a.srfkey==undefined||a.srfkey==null||a.srfkey==""){IBiz.alert("提交流程发生错误","当前表单未加载数据！",2);return}b.ignoreUFI=true;b.ignoreformfieldchange=true;b.load(a,function(d,f){b.setFieldAsyncConfig(f.config);b.setFieldState(f.state);b.setDataAccAction(f.dataaccaction);b.fillForm(f.data);b.formDirty=false;b.fireEvent(IBizForm.FORMLOADED);b.fireEvent(IBizForm.FORMWFSUBMITTED);b.ignoreUFI=false;b.ignoreformfieldchange=false;b.fireEvent(IBizForm.FORMFIELDCHANGED,null)},function(d,f){f.failureType="SERVER_INVALID";IBiz.alert("","工作流提交发生错误,"+b.getActionErrorInfo(f),2);b.ignoreUFI=false;b.ignoreformfieldchange=false})},doUIAction:function(a){var b=this;if(!a){a={}}$.extend(a,{srfaction:"uiaction"});if(IBizApp_Data){a.srfappdata=IBizApp_Data}b.loadingTag=IBiz.beginload();IBiz.ajax({url:b.config.url,params:a,method:"POST",dataType:"json",success:function(c){IBiz.endload(b.loadingTag);if(c.ret==0){IBiz.processResultBefore(c);b.fireEvent(IBizEditForm.UIACTIONFINISHED,b,c);if(c.reloadData){b.reload()}if(c.info&&c.info!=""){IBiz.alert("",c.info,1)}IBiz.processResult(c)}else{IBiz.alert("","操作失败,"+c.errorMessage,2)}},failure:function(c){IBiz.endload(b.loadingTag);IBiz.alert("","执行请求异常",2)}})},getFormType:function(){return"EDITFORM"}});IBizEditForm.UIACTIONFINISHED="UIACTIONFINISHED";IBizEditForm.FORMBEFORESAVE="FORMBEFORESAVE";IBizEditForm.FORMSAVEERROR="FORMSAVEERROR";var IBizFormDRPanel=IBizField.extend({parentData:null,drController:null,construct:function(c){arguments.callee.$.construct.call(this,c);var f=this.getForm();f.on("formloaded",function(h,k,l){var j=l.data;j.refreshDRUIPart()},this);f.on(IBizEditForm.FORMBEFORESAVE,function(h,k,l){var j=l.data;if(!j.saveDRData()){if(k){k.srfcancel=true}return false}},this);var b=c.refreshitems;if(b&&b!=""){var a=b.split(";");this.hookItems={};for(var d=0;d<a.length;d++){this.hookItems[a[d].toLowerCase()]=true}f.on(IBizForm.FORMFIELDCHANGED,function(j,l,m){var k=m.data;var h="";if(j!=null){h=j.getName()}else{return}if(k.isRefreshItem(h)){k.refreshDRUIPart()}},this)}var g=c.dritem;this.drController=f.getController().getController(f.getController().getCId2()+g.embedviewid);this.drController.on("DRDATASAVED",function(h,k,l){var j=l.data;j.getForm().save2()},this);if(!this.drController.isInited()){this.drController.asyncInit({parentMode:g.parentmode,parentData:this.parentData,renderTo:this.getId()});return}},getName:function(){return this.config.name},isRefreshItem:function(a){var b=this;if(!a||a==""){return false}return b.hookItems[a.toLowerCase()]},setParentData:function(a){this.parentData=a},getForm:function(){var a=this;return a.config.form},refreshDRUIPart:function(){var b=this;var a=b.getForm();var d=a.findField("srfkey");if(d==null){return}var c=d.getValue();b.parentData={srfparentkey:c};var f=a.getActiveData();f.srfparentkey=c;f.srfparentdeid=f.srfdeid;delete f.srfkey;delete f.srfdeid;$.extend(b.parentData,{srfparentdata:JSON.stringify(f)});b.drController.setParentData(b.parentData);b.drController.refresh()},saveDRData:function(){var a=this;if($.isFunction(a.drController.saveDRData)){return a.drController.saveDRData()}return true}});var IBizFormRawItem=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+b.getUniqueId())},setDisabled:function(a){var b=this;b.disabled=a},setHidden:function(b){var a=this;a.hidden=b;if(a.field){if(b){a.field.addClass("hidden")}else{a.field.removeClass("hidden")}}}});var IBizFormButton=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+b.getUniqueId());b.field.click(function(c){b.onClick()})},onClick:function(){var b=this;if(b.config.uiaction&&b.config.actiontype=="UIACTION"){var a=b.getForm().getController().getUIAction(b.config.uiaction.tag);b.getForm().getController().doUIAction(a);return}if(b.config.fiupdate&&b.config.actiontype=="FIUPDATE"){b.getForm().updateFormItems({srfufimode:b.config.fiupdate.tag});return}}});var IBizPictureField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.uploapath=BASEURL+"/ibizutil/uploadfile.jsp?";b.exportpath=BASEURL+"/ibizutil/exportfile.jsp?";b.field=$("#"+this.getUniqueId());b.image=b.field.find(".ibiz-id-image");b.uploadbtn=b.field.find(".ibiz-id-upload");b.removebtn=b.field.find(".ibiz-id-remove");if(a.width&&a.width>0){b.image.width(a.width-40)}if(a.height&&a.height>0){b.image.height(a.height)}if(b.uploadbtn){b.uploadbtn.click(function(){b.onUploadBtnClick()})}if(b.removebtn){b.removebtn.click(function(){b.onRemoveBtnClick()})}},setDisabled:function(a){arguments.callee.$.setDisabled.call(this,a);var b=this;if(b.uploadbtn){b.uploadbtn.prop("disabled",a);b.uploadbtn.attr("disabled",a)}if(b.removebtn){b.removebtn.prop("disabled",a);b.removebtn.attr("disabled",a)}},onValueChanged:function(a,b){arguments.callee.$.onValueChanged.call(this,a,b);var c=this;if(b){c.image.attr("src",c.exportpath+"fileid="+b)}else{c.image.attr("src","")}},onUploadBtnClick:function(){var b=this;if(b.isDisabled()){return}if(window.ActiveXObject&&!$.support.leadingWhitespace){b.openUploadView()}else{var a=$('<INPUT type="file" name="files">');a.change(function(){var c=a.val();if(c==""){return}$.ajaxFileUpload({url:b.uploapath,secureuri:false,fileElement:a,dataType:"json",success:function(f,d){if(f&&typeof(f)==="object"){if(d!="success"){IBiz.alert("上传失败",f.message,2)}else{b.setValue(f.files[0].id)}}else{IBiz.alert("","上传文件失败.",2)}},error:function(f,d,g){IBiz.alert("","上传文件失败.",2)}})});a.click()}},onRemoveBtnClick:function(){var a=this;if(a.isDisabled()){return}a.setValue("")},uploadCallback:function(c){var a=c.opener;var b=c.files;if(b&&b.length>0){a.setValue(b[0].id)}},openUploadView:function(){var a=this;var b=$.getIBizApp().createWindow({});b.opener=a;b.title="上传文件";b.height=500;b.width=600;b.url=BASEURL+"/ibizutil/fileuploadview.jsp?"+$.param({windowid:b.getId()});b.callback=a.uploadCallback;b.openModal(window)}});var IBizPictureUploaderField=IBizField.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+this.getUniqueId());b.containerEL=b.field.find(".ibiz-fileupload-container");b.container=$(b.containerEL);b.uploadbtnEL=b.field.find(".ibiz-fileupload-upload");b.uploadbtn=$(b.uploadbtnEL);b.uploadbtn.click(function(){b.openUploadView("")})},getValue:function(){if(this.value){try{if(this.value.length==0){return""}}catch(a){}return JSON.stringify(this.value)}return""},setValue:function(c){var b=this;if(c&&c!==""){if(typeof(c)!=="object"){try{c=JSON.parse(c)}catch(d){c=[]}}}else{c=[]}var a=b.value;b.value=c;b.render(b.value);if(a!=c){b.onValueChanged(a,b.value)}},render:function(c){var b=this;if(c){var a=[];$.each(c,function(d,f){var j=f.id;var h=f.name;var g='<li data-ibiz-fileid="'+j+'" class="ibiz-fileupload-item select2-search-choice ms-hover">';g+="<div>"+h+"</div>";g+='<a href="#" class="ibiz-fileupload-remove select2-search-choice-close" tabindex="-1"></a>';g+="</li>";a.push(g)});b.container.html(a.join(""));b.container.find(".ibiz-fileupload-remove").each(function(d,f){$(f).click(function(){b.removeFile($(this).parent().attr("data-ibiz-fileid"))})});b.container.find(".ibiz-fileupload-item").each(function(d,f){$(f).dblclick(function(){b.openFile($(this).attr("data-ibiz-fileid"))})})}else{b.container.html("")}},removeFile:function(c){var b=this;var a=[];if(b.value){$.each(b.value,function(d,f){if(f.id!=c){a.push(f)}})}b.setValue(a)},openFile:function(a){window.open(BASEURL+"/../ibizutil/exportfile.jsp?fileid="+a,"_blank")},uploadCallback:function(d,c){var b=d.opener;if(c){if(b.value){var a=$.merge(b.value,c);b.setValue(a)}else{b.setValue(c)}}},openUploadView:function(c){var a=this;var b=$.getIBizApp().createWindow({});b.opener=a;b.title="上传文件";b.height=500;b.width=600;b.url=BASEURL+"/util/fileuploadview.jsp?"+$.param({windowid:b.getId()});b.callback=a.uploadCallback;b.openModal(window)}});var IBizDRBar=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);$("#"+a.id).jstree({core:{multiple:false,data:{url:a.url,data:function(b){return{id:b.id,srfaction:"fetch",srfappdata:IBizApp_Data,srfrender:"JSTREE"}}}}});$("#"+a.id).on("changed.jstree",this,function(g,f){var c,b,d=[];for(c=0,b=f.selected.length;c<b;c++){d.push(f.instance.get_node(f.selected[c]))}g.data.onSelectionChange(f.instance,d,g)})},parentData:null,getDRTab:function(){return this.config.tabctrl},onSelectionChange:function(p,b,h){var l=this;if(b==null||b.length==0){return}var c=b[0];var m=c.original.dritem;if(m==null){return}var d=l.getController();var o=l.getDRTab();if(c.id=="form"){o.setActiveItem(0);return}if(m.viewid==undefined||m.viewid==""){return}var n="";if(l.parentData){n=l.parentData.srfparentkey}if(!n||n==""){o.setActiveItem(0);IBiz.alert("","请先建立主数据！",0);return}var j={};var g=m.viewparam;if(!g){return}if(true){$.extend(j,g);$.extend(j,l.parentData)}var k=d.getDRItemView(m);if(k==null){return}var f=o.id+"_"+m.viewid.replace(new RegExp(":","g"),"_");o.setActiveItem(f);var a=d.getController(d.getCId2()+k.embedviewid);if(!a.isInited()){a.asyncInit({parentMode:g,parentData:j,renderTo:f,subApp:k.subapp,autoLayout:false});return}a.setParentData(j);a.refresh()},setParentData:function(a){this.parentData=a}});var IBizTab=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.field=$("#"+b.config.id);b.field.find('a[data-toggle="tab"]').on("shown.bs.tab",function(c){b.fireEvent(IBizTab.SELECTIONCHANGE,b,c)})},setActiveItem:function(a){if($.isNumeric(a)){$("#"+this.config.id+" li:eq("+a.toString()+") a").tab("show")}else{$("#"+this.config.id+' a[href="#'+a+'"]').tab("show")}},setSize:function(b,a){var c=this;$("#"+c.id).width(b);$("#"+c.id).height(a)},getHeight:function(){var a=this;return $("#"+a.id).height()},getWidth:function(){var a=this;return $("#"+a.id).width()}});IBizTab.SELECTIONCHANGE="SELECTIONCHANGE";var IBizExpTab=IBizTab.extend({setActiveSubController:function(a){var b=this;b.activeSubController=a;if(b.activeSubController!=null){b.activeSubController.setSize(b.getWidth(),b.getHeight())}},setSize:function(b,a){arguments.callee.$.setSize.call(this,b,a);var c=this;if(c.activeSubController!=null){c.activeSubController.setSize(b,a)}}});var IBizExpBar=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);$("#"+a.id).jstree({core:{multiple:false,data:{url:a.url,data:function(b){return{id:b.id,srfaction:"fetch",srfappdata:IBizApp_Data,srfrender:"JSTREE"}}}}});$("#"+a.id).on("changed.jstree",this,function(h,g){var f=h.data;var c,b,d=[];for(c=0,b=g.selected.length;c<b;c++){d.push(g.instance.get_node(g.selected[c]))}f.onSelectionChange(g.instance,d,h)});$("#"+a.id).on("loaded.jstree",this,function(d,c){var b=d.data})},parentData:null,getExpTab:function(){return this.config.tabctrl},onSelectionChange:function(o,b,h){var l=this;if(b==null||b.length==0){return}var c=b[0];var m=c.original.expitem;if(m==null){return}var d=l.getController();var n=l.getExpTab();if(m.viewid==undefined||m.viewid==""){return}var j={};var g=m.viewparam;if(!g){return}if(true){$.extend(j,g);$.extend(j,l.parentData)}var k=d.getExpItemView(m);if(k==null){return}var f=n.id+"_"+m.viewid.replace(new RegExp(":","g"),"_");n.setActiveItem(f);var a=d.getController(d.getCId2()+k.embedviewid);if(!a.isInited()){a.asyncInit({parentMode:g,parentData:j,renderTo:f});return}a.setParentData(j);a.refresh()},setParentData:function(a){this.parentData=a}});var IBizExpBar2=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.container=$("#"+a.id);b.container.addClass("inbox");b.items={};b.itemELMap={};b.selectitem=null;var c={srfaction:"fetch",srfappdata:IBizApp_Data,srfrender:"JSTREE"};IBiz.ajax({url:b.config.url,params:c,method:"POST",success:function(d){b.renderData(d)},failure:function(d){alert("加载菜单失败,"+d)}});if(a.countertag){b.uiCounter=b.getController().getUICounter(a.countertag);if(b.uiCounter){b.uiCounter.on(IBizCounter.COUNTERCHANGED,function(f,d,g){g.data.onCounterChanged()},b)}}},onCounterChanged:function(){var b=this;if(!b.uiCounter){return}var c=b.uiCounter.getData();if(!c){return}var f=false;var d=null;$.each(b.itemELMap,function(m,l){var h=b.items[m];if(!d){d=h}var j=h.counterid;var g=h.countermode;var k=c[j];if(!k){k=0}b.changeItemCount(l,k);if(k==0&&g&&g==1){l.addClass("hidden");if(b.selectitem&&b.selectitem.id==h.id){f=true;l.removeClass("active")}}else{l.removeClass("hidden")}});if(f){b.selectitem=d;var a=b.itemELMap[d.id];a.addClass("active");b.onSelectionChange(null,[b.selectitem],null)}},renderData:function(d){var h=this;var g=h.renderTreeMenu(d,0);h.container.html('<ul class="inbox-nav margin-bottom-10">'+g.join("")+"</ul>");h.container.find(".inbox").each(function(m,n){h.itemELMap[$(n).attr("ibiz-id")]=$(n);$(n).click(n,function(o){h.container.find(".inbox-nav > li.active").removeClass("active");$(this).addClass("active");h.onItemClick($(this))})});var k=false;var l;var j;var c;var f=h.config.activeitem;$.each(h.items,function(m,n){if(!j){j=n}if(n.selected){k=true;l=n}if(f){if(n.id==f){c=n}}});if(!k){l=j}if(c){l=c}var a=l.id;var b=h.itemELMap[a];if(b){b.addClass("active");h.onItemClick(b)}h.onCounterChanged()},changeItemCount:function(c,b){if(!c){return}var a=c.find(".ibiz-counter");if(a){if(b>0){a.html(b);a.removeClass("hidden")}else{a.addClass("hidden")}}},onItemClick:function(b){var a=this;var c=b.attr("ibiz-id");var b=a.items[c];a.selectitem=b;a.onSelectionChange(null,[a.selectitem],null)},renderTreeMenu:function(a,g){var d=this;var f=[];if(a&&a.length>0){var b=[];for(var c=0;c<g;c++){b.push("&nbsp;&nbsp;")}b=b.join("");$.each(a,function(j,m){var k=m.children;d.items[m.id]=m;var l="";if(g==0){l="font-weight:bold;border-left:4px solid #1BBC9B;"}if(k){f.push('<li class="inbox" ibiz-id="'+m.id+'">');f.push('<a href="javascript:;" data-title="Inbox" style="'+l+'" class="btn">');f.push(b+m.text+"<b></b>");f.push('<span class="badge badge-default ibiz-counter hidden"></span>');f.push("</a>");f.push("</li>");var h=d.renderTreeMenu(k,(g+1));f=f.concat(h)}else{f.push('<li class="inbox" ibiz-id="'+m.id+'">');f.push('<a href="javascript:;" data-title="Inbox" style="'+l+'" class="btn">');f.push(b+m.text+"<b></b>");f.push('<span class="badge badge-default ibiz-counter hidden"></span>');f.push("</a>");f.push("</li>")}})}return f},parentData:null,getExpTab:function(){return this.config.tabctrl},onSelectionChange:function(o,b,h){var l=this;if(b==null||b.length==0){return}var c=b[0];var m=c.expitem;if(m==null){return}var d=l.getController();var n=l.getExpTab();if(m.viewid==undefined||m.viewid==""){return}var j={};var g=m.viewparam;if(!g){return}if(true){$.extend(j,g);$.extend(j,l.parentData)}var k=d.getExpItemView(m);if(k==null){return}var f=n.id+"_"+m.viewid.replace(new RegExp(":","g"),"_");n.setActiveItem(f);var a=d.getController(d.getCId2()+k.embedviewid);l.activeSubController=a;n.setActiveSubController(a);if(!a.isInited()){a.asyncInit({parentMode:g,parentData:j,renderTo:f});return}a.setParentData(j);a.refresh()},setParentData:function(a){this.parentData=a}});var IBizViewPanel=IBizTab.extend({construct:function(a){arguments.callee.$.construct.call(this,a)}});var IBizDashboard=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a)}});var IBizChart=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.chart=echarts.init(document.getElementById(this.getId()));b.chart.on("click",function(c){b.fireEvent(IBizChart.CLICK,b,c)});b.chart.on("dblclick",function(c){b.fireEvent(IBizChart.DBLCLICK,b,c)})},buildChart:function(a){var b=this;var c={};b.fireEvent(IBizChart.BEFORELOAD,b,c);c.srfrender="ECHARTS3";c.srfaction="FETCH";b.loadingTag=IBiz.beginload();IBiz.ajax({url:b.config.url,params:c,method:"POST",success:function(d){IBiz.endload(b.loadingTag);if(d.ret==0){setTimeout(function(){b.fireEvent(IBizChart.LOADED,b,d)},1);b.renderData(d)}else{IBiz.alert("",d.info,1)}},failure:function(d){IBiz.endload(b.loadingTag);IBiz.alert("","加载数据失败,"+d,1)}})},load:function(){var a=this;a.buildChart()},renderData:function(c){var b=this;var a=null;if(b.config.render){a=b.config.render(c.items,c,b)}else{a={};if(b.config.baseopt){$.extend(a,b.config.baseopt)}if(c.data){$.extend(a,c.data)}}b.chart.setOption(a,true)},setSize:function(c,a){var d=this;var b=$("#"+this.getId());b.height(a);d.chart.resize()},getChart:function(){var a=this;return a.chart}});IBizChart.BEFORELOAD="BEFORELOAD";IBizChart.LOADED="LOADED";IBizChart.DBLCLICK="DBLCLICK";IBizChart.CLICK="CLICK";var IBizReportPanel=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this},buildReport:function(a){var b=this;var d={};b.fireEvent(IBizReportPanel.BEFORELOAD,b,d);delete d.srfaction;d.srfreportid=b.config.reportid;var c=$("#"+this.getId());if(c[0]){var f=b.config.reporturl;if(!f||f==""){f=BASEURL+"/ibizutil/report.pdf"}else{f=BASEURL+f}f=f+(f.indexOf("?")==-1?"?":"&")+$.param(d);c.attr("src",f)}},load:function(){var a=this;a.buildReport()},setSize:function(c,a){var d=this;var b=$("#"+this.getId());b.height(a)}});IBizReportPanel.BEFORELOAD="BEFORELOAD";IBizReportPanel.LOADED="LOADED";var IBizList=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.reload();if(b.timer>1000){setInterval(function(){b.reload()},b.timer)}},renderData:function(c){var b=this;var a;if(b.config.render){a=b.config.render(c.items,c,b)}if(a){$("#"+b.getId()).html(a)}b.initSlimScroll(".scroller");$("#"+b.getId()).find(".ibiz-listrefresh").click(function(d){b.reload()})},reload:function(){var b=this;var a=b.config.url;IBiz.ajax({url:a,params:{srfaction:"FETCH"},method:"POST",success:function(c){if(c.ret==0){if(c.items){b.renderData(c)}}else{IBiz.alert("",c.info,2)}},failure:function(c){$("#"+b.getId()).html("加载数据失败")}})},initSlimScroll:function(a){$(a).each(function(){var b;if($(this).attr("data-height")){b=$(this).attr("data-height")}else{b=$(this).css("height")}$(this).slimScroll({height:b})})}});var IBizDataView=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.container=$("#"+a.id);b.container.addClass("tiles");b.selections=[];b.itemMap={};IBiz.ajax({url:b.config.url,params:{srfaction:"FETCH"},method:"POST",success:function(c){if(c&&c.ret==0){b.onDataLoaded(c.items)}else{IBiz.alert("","加载数据失败,"+c.info,2)}},failure:function(c){IBiz.alert("","加载数据失败,"+c,2)}})},onDataLoaded:function(a){var b=this;b.renderData(a)},setSelection:function(a){},getSelection:function(){var a=this;return a.selections},renderData:function(a){var d=this;if(!a){return}var b=[];$.each(a,function(f,h){d.itemMap[h.srfkey]=h;var g=d.renderRow(h,f);b=b.concat(g)});d.container.html(b.join(""));var c=null;d.container.find(".ibiz-id-tile").click(function(g){clearTimeout(c);var f=$(this);c=setTimeout(function(){d.container.find(".tile").removeClass("selected");var h=f.attr("data-ibiz-id");f.find(".tile").addClass("selected");d.selections=[d.itemMap[h]];d.fireEvent(IBizDataView.SELECTIONCHANGE,d,d.selections)},200)});d.container.find(".ibiz-id-tile").dblclick(function(f){clearTimeout(c);d.container.find(".tile").removeClass("selected");var g=$(this).attr("data-ibiz-id");$(this).addClass("selected");d.selections=[d.itemMap[g]];d.fireEvent(IBizDataView.ROWDBLCLICK,d,d.itemMap[g])})},renderRow:function(d,a){var c=this;var b=[];b.push('<div class="ibiz-id-tile" data-ibiz-id="'+d.srfkey+'">');if(c.config.render){b.push(c.config.render(d,a))}else{b.push('<div class="tile bg-purple-studio">');b.push('	<div class="tile-body">');b.push('		<i class="fa fa-bars"></i>');b.push("	</div>");b.push('	<div class="tile-object">');b.push('		<div style="text-align:center;">'+d.srfmajortext+"</div>");b.push("	</div>");b.push("</div>")}b.push("</div>");return b},load:function(){var a=this}});IBizDataView.SELECTIONCHANGE="SELECTIONCHANGE";IBizDataView.ROWDBLCLICK="ROWDBLCLICK";IBizDataView.BEFORELOAD="BEFORELOAD";IBizDataView.LOADED="LOADED";var IBizPortlet=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;if(a.timer>1000){setInterval(function(){b.reload()},a.timer)}},reload:function(){}});var IBizChartPortlet=IBizPortlet.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.chart=new IBizChart({ctrler:this.getController(),id:this.getId()+"_chart",url:this.getController().getBackendUrl()+"srfctrlid="+this.getName()+"_chart&"})}});var IBizListPortlet=IBizPortlet.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;a.listcfg.ctrler=b.config.ctrler;b.listctrl=new IBizList(a.listcfg)},reload:function(){var a=this;a.listctrl.reload()}});var IBizCustomPortlet=IBizPortlet.extend({construct:function(a){arguments.callee.$.construct.call(this,a)}});var IBizHtmlPortlet=IBizPortlet.extend({construct:function(a){arguments.callee.$.construct.call(this,a)}});var IBizViewPortlet=IBizPortlet.extend({construct:function(a){arguments.callee.$.construct.call(this,a)}});var IBizPickupViewPanel=IBizViewPanel.extend({parentData:null,construct:function(a){arguments.callee.$.construct.call(this,a);var d=this;for(var c=0;c<10;c++){var f="pickupviewpanel"+((c==0)?"":c.toString());var b=this.getController().getPickupViewItem({viewid:f});if(b!=null){d.activeViewItem(f);return}}},setSize:function(b,a){var c=this;$("#"+c.id+"_pickupviewpanel").width(b);$("#"+c.id+"_pickupviewpanel").height(a);if(c.activeSubController!=null){c.activeSubController.setSize(b,a)}},activeViewItem:function(g){var d=this;var a=this.getController();var b=a.getPickupViewItem({viewid:g});var f=this.getId()+"_"+g.replace(new RegExp(":","g"),"_");d.setActiveItem(f);var c=a.getController(a.getCId2()+b.embedviewid);d.activeSubController=c;if(!c.isInited()){if(a.getViewParam().srfreferdata){c.getViewParam().srfreferdata=a.getViewParam().srfreferdata}if($.isFunction(a.isEnableMultiSelect)&&$.isFunction(c.setEnableMultiSelect)){c.setEnableMultiSelect(a.isEnableMultiSelect())}c.asyncInit({parentData:d.parentData,renderTo:f,referData:a.getReferData()});c.on(IBizPickupViewPanel.SELECTIONCHANGE,d.onSelectionChange,d);c.on(IBizPickupViewPanel.DATAACTIVATED,d.onDataActivated,d);return}c.setParentData(d.parentData);c.refresh()},getAllData:function(){var a=this;if(a.activeSubController){return a.activeSubController.getAllData()}return[]},onSelectionChange:function(c,a,d){var b=d.data;b.fireEvent(IBizPickupViewPanel.SELECTIONCHANGE,b,a)},onDataActivated:function(c,a,d){var b=d.data;b.fireEvent(IBizPickupViewPanel.DATAACTIVATED,b,a)},setParentData:function(a){var c=this;c.parentData=a;if(c.activeSubController){var b=c.activeSubController;b.setParentData(c.parentData);b.refresh()}else{}},refreshViewPanel:function(){var a=this;if(a.activeSubController){a.activeSubController.refresh()}}});IBizPickupViewPanel.SELECTIONCHANGE="SELECTIONCHANGE";IBizPickupViewPanel.DATAACTIVATED="DATAACTIVATED";var IBizTree=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.catalog="";$("#"+a.id).css("overflow","auto");$("#"+a.id).jstree({core:{multiple:false,data:{url:a.url,type:"POST",data:function(c){var d=b.getController().getViewParam();if(!d){d={}}return{srfnodeid:c.id,srfaction:"fetch",srfappdata:IBizApp_Data,srfrender:"JSTREE",srfcatalog:b.catalog,srfviewparam:JSON.stringify(d)}}}}});$("#"+a.id).on("changed.jstree",this,function(h,g){var d,c,f=[];for(d=0,c=g.selected.length;d<c;d++){f.push(g.instance.get_node(g.selected[d]))}b.fireEvent(IBizTree.SELECTIONCHANGE,b,f)});$("#"+a.id).on("load_node.jstree",this,function(d,c){if(c.node.id=="#"){if(c.node.children.length>0){$("#"+b.getId()).jstree("select_node",c.node.children[0])}}})},setSize:function(b,a){var c=this;$("#"+c.getId()).width(b);$("#"+c.getId()).height(a)},setCatalog:function(a){var b=this;b.catalog=a;$("#"+b.getId()).jstree("refresh")},load:function(){var a=this;$("#"+a.getId()).jstree("refresh")}});IBizTree.SELECTIONCHANGE="SELECTIONCHANGE";var IBizTreeExpBar=IBizControl.extend({construct:function(b){arguments.callee.$.construct.call(this,b);var c=this;var a=c.getController().getBackendUrl()+"srfctrlid="+this.getId()+"_tree&";c.tree=new IBizTree({id:this.getId()+"_tree",url:a,ctrler:b.ctrler});c.tree.on(IBizTree.SELECTIONCHANGE,function(f,d,h){var g=h.data;g.onTreeSelectionChange(f,d,h)},c);c.getController().registerItem(this.getName()+"_tree",c.tree);c.treecat=$("#"+this.getId()+"_cat");if(c.treecat){c.treecat.on("change",c,function(f){var d=c.treecat.val();c.tree.setCatalog(d)});c.fetchCat(a,{srfaction:"fetchcat",srfappdata:IBizApp_Data})}},setSize:function(b,a){var c=this;$("#"+c.getId()).height(a);$("#"+c.getId()).width(b)},getTree:function(){return me.tree},getExpTab:function(){return this.config.tabctrl},getExpFrame:function(){return this.config.expframe},getPVPanel:function(){return this.config.pvpanel},onTreeSelectionChange:function(m,r,b){var s=this;if(r==null||r.length==0){return}var c=r[0];if(!c.original){return}var t=c.original.tag;if(!t||!(t.srfnodetype)){return}var k=c.id.split(";");var f=c.text;var n=s.getController();if(s.getExpTab()){var a={viewid:t.srfnodetype};var l=n.getExpItemView(a);if(l==null){return}var o=s.getExpTab();var j=o.id+"_"+t.srfnodetype;o.setActiveItem(j);var g={};if(l.viewparam){$.extend(g,l.viewparam)}for(var u in g){var p=g[u];if(p){p=p.replace(new RegExp("%NODETEXT%","g"),f);for(var q=1;q<k.length;q++){p=p.replace(new RegExp("%NODEID"+((q==1)?"":q.toString())+"%","g"),k[q])}g[u]=p}}var h=n.getController(n.getCId2()+l.embedviewid);o.setActiveSubController(h);if(!h.isInited()){h.asyncInit({parentData:g,renderTo:j,subApp:l.subapp});return}h.setParentData(g);h.refresh();return}if(s.getPVPanel()){var a={nodetype:t.srfnodetype};var g=n.getNavViewParam(a);if(g==null){return}for(var u in g){var p=g[u];if(p){p=p.replace(new RegExp("%NODETEXT%","g"),f);for(var q=1;q<k.length;q++){p=p.replace(new RegExp("%NODEID"+((q==1)?"":q.toString())+"%","g"),k[q])}g[u]=p}}s.getPVPanel().setParentData(g);return}if(s.getExpFrame()){var a={viewid:t.srfnodetype};var l=n.getExpItemView(a);if(l==null){return}var g={};if(l.viewparam){$.extend(g,l.viewparam)}for(var u in g){var p=g[u];if(p){p=p.replace(new RegExp("%NODETEXT%","g"),f);for(var q=1;q<k.length;q++){p=p.replace(new RegExp("%NODEID"+((q==1)?"":q.toString())+"%","g"),k[q])}g[u]=p}}var d=$.getIBizApp().parseURL(BASEURL,l.viewurl,{});d+="&"+$.param({srfifchild:true,srfparentdata:JSON.stringify(g)});s.getExpFrame().attr("src",d);return}},fetchCat:function(b,a){var c=this;IBiz.ajax({url:b,params:a,method:"POST",success:function(f){if(f.ret==0){var g="";var d=[];if(f.items){$.each(f.items,function(h,j){d.push('<option value="'+j.value+'">'+j.text+"</option>");if(g==""){g=j.value}})}if(c.treecat){c.treecat.html(d.join(""))}c.tree.setCatalog(g)}else{IBiz.alert("","获取树分类数据发生错误,"+f.errorMessage,2)}},failure:function(d){IBiz.alert("","获取树分类数据发生错误,请求发生错误",2)}})}});var IBizDRTab=IBizTab.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.on(IBizTab.SELECTIONCHANGE,function(d,c,g){var f=g.data;f.onTabSelectionChange(c)},b);b.setActiveItem(0)},parentData:null,onTabSelectionChange:function(h){var l=this;var b=h.target.attributes.href.value;var f=b.replace(new RegExp("#","g"),"");var k=b.replace(new RegExp("#"+l.id+"_","g"),"");var c=l.getController();if(k=="form"){l.setActiveItem(0);return}var n="";if(l.parentData){n=l.parentData.srfparentkey}if(!n||n==""){l.setActiveItem(0);IBiz.alert("","请先建立主数据！",0);return}var m={viewid:k};if(m.viewid==undefined||m.viewid==""){return}var j=c.getDRItemView(m);if(j==null||!j.viewparam){return}var d=j.viewparam;var g={};if(true){$.extend(g,d);$.extend(g,l.parentData);if(d.srfparentdeid){g.srfparentdeid=d.srfparentdeid}}var f=l.id+"_"+m.viewid.replace(new RegExp(":","g"),"_");l.setActiveItem(f);var a=c.getController(c.getCId2()+j.embedviewid);if(!a.isInited()){a.asyncInit({parentMode:d,parentData:g,renderTo:f,subApp:j.subapp,autoLayout:false});return}a.setParentData(g);a.refresh()},setParentData:function(a){var b=this;b.parentData=a;var c={};if(b.parentData){$.extend(c,b.parentData)}c.srfaction="FETCH";IBiz.ajax({url:b.config.url,params:c,method:"POST",success:function(d){if(d.ret==0){if(d.items){$.each(d.items,function(f,g){if(g.enabled==undefined){return}var h=g.dritem;if(!h||!h.viewid){return}if(g.enabled){$("#"+b.getId()+"_h_"+h.viewid).show()}else{$("#"+b.getId()+"_h_"+h.viewid).hide()}})}}else{IBiz.alert("",d.info,1)}},failure:function(d){IBiz.alert("","获取数据关系失败,"+d,1)}})}});var IBizWFStepActor=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.container=$("#"+a.id);b.container.addClass("tiles");b.itemMap={};b.selections=[];b.load()},load:function(){var a=this;a.refresh()},refresh:function(){var a=this;var b={};a.fireEvent(IBizWFStepActor.BEFORELOAD,a,b);b.offset=b.start;b.limit=b.length;b.srfrender="JQUERYDATATABLES";IBiz.ajax({url:a.config.url,params:b,method:"POST",success:function(c){a.onDataLoaded(c)},failure:function(c){IBiz.alert("加载菜单失败",c,2)}})},onDataLoaded:function(d){var c=this;if(d.ret!=0){IBiz.alert("加载数据失败",d.info,2);return}var a=[];var f=$("#"+c.config.id+"_cap");if(d.activestep){a.push("<small>&nbsp;当前环节&nbsp;</small>");a.push(d.activestep.wfplogicname);a.push("<small>&nbsp;处理人员:</small>")}f.html(a.join(""));var b=[];$.each(d.items,function(g,k){c.itemMap[k.srfkey]=k;var j=k.wfstepactorname;var h=k.remindercount;b.push('<div class="ibiz-id-tile" data-ibiz-id="'+k.srfkey+'">');b.push('<div class="tile bg-purple-studio" style="');if(k.isfinish==1){b.push("border-color: #888 !important;background-color: #888 !important;")}b.push('">');b.push("	<div>");b.push('		<div style="text-align:right;">');if(h>0){b.push('			<span class="badge badge-default ibiz-id-counter">');b.push(h);b.push("			</span>")}b.push("</div>");b.push('	<div class="tile-body">');b.push('			<i class="fa fa-user"></i>');b.push("	</div>");b.push('	<div class="tile-object">');b.push('		<div style="text-align:center;">');b.push(j);b.push("</div>");b.push("	</div>");b.push("</div>");b.push("</div>");b.push("</div>")});c.container.html(b.join(""));c.container.find(".ibiz-id-tile").dblclick(function(g){c.container.find(".tile").removeClass("selected");var h=$(this).attr("data-ibiz-id");$(this).addClass("selected");c.selections=[c.itemMap[h]];c.fireEvent(IBizWFStepActor.ROWDBLCLICK,c,c.selections)})}});IBizWFStepActor.BEFORELOAD="BEFORELOAD";IBizWFStepActor.ROWDBLCLICK="ROWDBLCLICK";var IBizWFTimeline=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.container=$("#"+a.id);b.load()},load:function(){var a=this;a.refresh()},selectItem:function(c){var b=this;if(c&&c.wfstepvalue){var a=[];if(b.items){$.each(b.items,function(d,f){if(c.wfstepvalue==f.wfstepname){a.push(f)}})}b.renderItems(a)}else{b.renderItems(b.items)}},refresh:function(){var a=this;var b={};a.fireEvent(IBizWFTimeline.BEFORELOAD,a,b);b.offset=b.start;b.limit=b.length;b.srfrender="JQUERYDATATABLES";IBiz.ajax({url:a.config.url,params:b,method:"POST",success:function(c){a.onDataLoaded(c)},failure:function(c){IBiz.alert("加载菜单失败",c,2)}})},renderItems:function(a){var c=this;var b=[];$.each(a,function(m,o){var k=o.wfstepid;var h=o.wfstepdataname;var g=o.actiontime;var f=o.actorname;var j=o.actorname2;var l=o.memo;var n=o.wfplogicname;var d="";if(j){d="("+j+" 代办)"}if(!f||f==null){f=""}if(!h||h==null){h=""}if(!g||g==null){g=""}else{g=moment(g).format("YYYY-MM-DD HH:mm")}if(!l||l==null){l=""}if(!n||n==null){n=""}b.push('<div data-ibiz-processid="'+k+'" class="timeline-item ibiz-wftimeline">');b.push('	<div class="timeline-badge">');b.push('		<div class="timeline-icon ">');b.push('			<i class="icon-user-following font-green-haze"></i>');b.push('		<div style="margin-left:-5px;">'+f+"</div>");b.push("		</div>");b.push("	</div>");b.push('	<div class="timeline-body">');b.push('		<div class="timeline-body-arrow">');b.push("		</div>");b.push('		<div class="timeline-body-head">');b.push('			<div class="timeline-body-head-caption">');b.push('				<a href="javascript:;" class="timeline-body-title font-blue-madison">');b.push(h);b.push("				</a>");b.push('				<span class="timeline-body-time font-grey-cascade">');b.push(g+d);b.push("				</span>");b.push("			</div>");b.push('			<div style="float:right">'+n+"</div>");b.push("		</div>");b.push('		<div class="timeline-body-content">');b.push('			<span class="font-grey-cascade">');b.push(l);b.push("			</span>");b.push("		</div>");b.push("	</div>");b.push("</div>")});c.container.html(b.join(""))},onDataLoaded:function(b){var a=this;if(b.ret!=0){IBiz.alert("加载数据失败",b.info,2);return}a.items=b.items;a.renderItems(b.items)}});IBizWFTimeline.BEFORELOAD="BEFORELOAD";var IBizMPickupResult=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var b=this;b.container=$("#"+a.id);b.field=b.container.find(".ibiz-id-select");b.itemMap={};b.selectionskeys=[];b.leftBtn=b.container.find(".ibiz-id-left");b.rightBtn=b.container.find(".ibiz-id-right");b.rightAllBtn=b.container.find(".ibiz-id-rightall");b.leftAllBtn=b.container.find(".ibiz-id-leftall");b.leftBtn.click(function(c){b.onLeftClick()});b.rightBtn.click(function(c){b.onRightClick()});b.rightAllBtn.click(function(c){b.onRightAllClick()});b.leftAllBtn.click(function(c){b.onLeftAllClick()});b.field.change(function(c){b.onListSelectChanged(b.field.val())})},onListSelectChanged:function(a){var b=this;b.selectionskeys=a},onLeftClick:function(){var a=this;a.getController().switchLeft()},onRightClick:function(){var a=this;a.getController().switchRight()},onRightAllClick:function(){var a=this;a.getController().switchRightAll()},onLeftAllClick:function(){var a=this;a.getController().switchLeftAll()},getDatas:function(){var b=this;var a=[];$.each(b.itemMap,function(c,d){a.push(d)});return a},getSelections:function(){var b=this;var a=[];if(b.selectionskeys){$.each(b.selectionskeys,function(c,f){var d=b.itemMap[f];if(d){a.push(d)}})}return a},clear:function(){var a=this;a.itemMap={};a.fireEvent(IBizMPickupResult.SELECTIONCHANGE,a,a.getDatas())},appendDatas:function(b){if(!b){return}var c=this;var a=false;$.each(b,function(d,f){if(!c.itemMap[f.srfkey]){c.itemMap[f.srfkey]=f;a=true}});if(a){c.renderUI();c.fireEvent(IBizMPickupResult.SELECTIONCHANGE,c,c.getDatas())}},removeDatas:function(b){if(!b){return}var c=this;var a=false;$.each(b,function(d,f){if(c.itemMap[f.srfkey]){delete c.itemMap[f.srfkey];a=true}});if(a){c.renderUI();c.fireEvent(IBizMPickupResult.SELECTIONCHANGE,c,c.getDatas())}},renderUI:function(){var b=this;var a=[];$.each(b.itemMap,function(c,d){a.push('<option value="'+d.srfkey+'">'+d.srfmajortext+"</option>")});if(b.field){b.field.html(a.join(""))}}});IBizMPickupResult.SELECTIONCHANGE="SELECTIONCHANGE";var IBizDataInfoBar=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.container=$("#"+a.id);this.title=this.container.find(".ibiz-id-title");this.content=this.container.find(".ibiz-id-content");this.icon=this.container.find(".ibiz-id-icon")},setCurrentData:function(b){var a=this;a.content.html(b.srfmajortext)}});var IBizMultiEditViewPanel=IBizControl.extend({editCtrlers:[],removeKeys:"",subindex:0,parentViewCtrler:null,construct:function(a){var b=this;arguments.callee.$.construct.call(this,a);b.parentViewCtrler=a.viewctrler;b.mainPanel=$("#"+b.getId());b.createMainPanel();b.addNewItemDiv()},load:function(){var b=this;var c={};if(b.parentViewCtrler.parentMode){$.extend(c,b.parentViewCtrler.parentMode)}if(b.parentViewCtrler.parentData){$.extend(c,b.parentViewCtrler.parentData)}var a=b.config.url+"srfaction=fetch&start=0&limit=500&";IBiz.ajax({url:a,params:c,method:"POST",dataType:"json",success:function(d){if(d.ret==0){if(d.items&&d.items.length>0){var f=true;$.each(d.items,function(g,h){var k=b.addItemDiv({srfkey:h.srfkey,srfmajortext:h.srfmajortext,active:f});var j={containerid:k,srfkey:h.srfkey};b.fireEvent(IBizMultiEditViewPanel.FINDEDITVIEWCONTROLLER,b,j);if(f){f=false}})}}else{console.log("加载计数数据异常."+d.info)}},failure:function(d){}})},addEditViewCtrler:function(a){if(!a.isInited()){if(a.config.srfkey){a.viewparam.srfkey=a.config.srfkey}var d=me.parentViewCtrler.parentMode;var b=me.parentViewCtrler.parentData;var f=a.config.containerid;var c=me.parentViewCtrler.subApp;$.extend(b,d);a.asyncInit({parentMode:d,parentData:b,renderTo:f,subApp:c});a.on(EditView9ControllerBase.FORMSAVED,function(g,j,k){var h=k.data;h.onEditViewSaved(g,j)},me);a.on(EditView9ControllerBase.FORMSAVEERROR,function(g,j,k){var h=k.data;h.onEditViewSaveError(g,j)},me);me.editCtrlers.push(a)}},onEditViewSaved:function(a,b){me=this;if(a){me.doTabs.pop(a.config.containerid)}if(!me.doTabs||me.doTabs.length==0){me.doMajorSave()}},onEditViewSaveError:function(a,b){},doNew:function(b){me=this;var c=me.addItemDiv({active:true});var a={pcontroller:me.parentViewCtrler,appctx:me.config.appctx,containerid:c};me.fireEvent(IBizMultiEditViewPanel.FINDEDITVIEWCONTROLLER,me,a)},doRemove:function(b){me=this;var a=me.editCtrlers.pop(b);if(a){var c="";var d=a.getForm().findField("srforikey");if(d){c=d.getValue()}if(c==undefined||c==""){d=a.getForm().findField("srfkey");if(d){c=d.getValue()}}if(c){if(me.removeKeys.length>0){me.removeKeys+=";"}me.removeKeys+=c}}me.onRemove(b)},doSave:function(){var a=this;a.errorTabId="";a.doTabs=[];var b=true;if(a.editCtrlers&&a.editCtrlers.length>0){$.each(a.editCtrlers,function(d,c){if(c.form.isDirty()){b=false;c.doSave({afterformsaveaction:"embedsave"});a.doTabs.push(c.config.containerid)}})}if(b){a.doMajorSave()}},doMajorSave:function(a,c){me=this;var b=true;if(me.removeKeys.length>0){b=false;var d={srfaction:"remove",srfkeys:me.removeKeys};IBiz.ajax({url:me.config.url,params:d,method:"POST",dataType:"json",async:false,success:function(f){me.removeKeys="";if(f.ret==0){me.parentViewCtrler.onDRDataSaved()}else{IBiz.alert("","删除失败,"+f.info,2)}},failure:function(f){IBiz.alert("","执行请求异常",2)}})}if(b){me.parentViewCtrler.onDRDataSaved()}},regRemoveUIAction:function(b){var a={type:"Remove"};$.extend(a,b);me.regUIAction(a)},tabItemClick:function(d,c){var b=this;var a=b.getUIAction(d.tag);if(!a){return}$.extend(a,d);b.doUIAction(a)},doUIAction:function(b){var a=this;if(b){if(b.type=="Add"){a.doNew(b);return}if(b.type=="Remove"){if(b.panelId){a.doRemove(b.panelId);return}}}},refresh:function(){var a=this;a.uiactions={};a.editCtrlers=[];a.removeKeys="";a.subindex=0;a.onRefresh();a.addNewItemDiv();a.load()},isDirty:function(){me=this;var a=false;if(me.removeKeys.length>0){a=true}else{$.each(me.editCtrlers,function(c,b){if(b.form&&b.form.isDirty()){a=true;return false}})}return a},getHeight:function(){return 600},regUIAction:function(b){var a=this;if(!a.uiactions){a.uiactions={}}a.uiactions[b.tag]=b},getUIAction:function(a){var b=this;if(b.uiactions){return b.uiactions[a]}return null},onRefresh:function(){},onRemove:function(a){},createMainPanel:function(){},addItemDiv:function(a){},addNewItemDiv:function(){}});IBizMultiEditViewPanel.FINDEDITVIEWCONTROLLER="FINDEDITVIEWCONTROLLER";var IBizMultiEditViewTabPanel=IBizMultiEditViewPanel.extend({header:{},content:{},construct:function(a){var b=this;arguments.callee.$.construct.call(this,a)},createMainPanel:function(){me=this;if(me.mainPanel){var a=me.getId()+"_header";var b=me.getId()+"_content";me.mainPanel.append('<ul class="nav nav-tabs " id="'+a+'"> </ul><div class="tab-content" id="'+b+'"> </div>');me.header=$("#"+a);me.content=$("#"+b)}},addNewItemDiv:function(){me=this;var a=me.getId()+"_new";me.header.append('<li> 	<button id ="'+a+'" class="btn btn-priamry" data-ibiz-tag="New"		style="margin-top: 9px;margin-left: 16px;">新建<i class="fa fa-plus"></i></button>	</li> ');me.newTab=$("#"+a);me.newTab.click(function(c){var d={};d.tag=$(this).attr("data-ibiz-tag");me.tabItemClick(d,c)});var b={type:"Add",tag:"New"};me.regUIAction(b)},addItemDiv:function(f){me=this;me.subindex++;var c="基本信息";if(f&&f.srfmajortext){c=f.srfmajortext}var d=me.getId()+"_"+me.subindex;var b=d+"_head";var a=d+"_remove";me.newTab.parent().before('<li class="" id="'+b+'"><a id="'+d+'_a" href="#'+d+'" data-toggle="tab">	<span id="'+d+'_caption">'+c+'</span>	<sub style="bottom: 1.4em;">		<span class="btn" style="padding:0px;" data-ibiz-tag="'+a+'" id="'+a+'">			<i class="fa fa-times"></i>		</span>	</sub></a></li>');var g='<div class="tab-pane row" id="'+d+'"></div>';me.content.append(g);$("#"+a).click(function(h){if(!f){f={}}f.tag=$(this).attr("data-ibiz-tag");me.tabItemClick(f,h)});me.regRemoveUIAction({panelId:d,tag:a});if(f&&f.active){$("#"+d+"_a").click()}return d},onRefresh:function(){me.header.empty();me.content.empty()},onEditViewSaved:function(b,d){arguments.callee.$.onEditViewSaved.call(this,b,d);var a="";var f=b.getForm().findField("srfmajortext");if(f){a=f.getValue()}if(a){var c=b.config.containerid;$("#"+c+"_caption").text(a)}},onEditViewSaveError:function(a,c){arguments.callee.$.onEditViewSaveError.call(this,a,c);var b=a.config.containerid;if(!me.errorTabId||b<me.errorTabId){$("#"+b+"_a").click()}},onRemove:function(b){var c=$("#"+b+"_head");if(c){if(c.attr("class")=="active"){var a=c.prev();if(a.length==0){a=c.next()}if(a.length>0){a.find("a").click()}}}$("#"+b+"_head").remove();$("#"+b).remove()}});var ViewControllerBase=IBizControl.extend({construct:function(a){arguments.callee.$.construct.call(this,a);var d=this;d.bInited=false;d.htmlwin=window;$.getIBizApp().regSRFController(d);d.lastTimer=new Date().getTime();setInterval(function(){d.lastTimer=new Date().getTime()},1000);d.autoLayout=a.autoLayout;if(d.autoLayout==undefined){d.autoLayout=false}d.itemMap={};d.ctrlers={};d.viewLogics={};d.pagecontext=new IBizPageContext(a);var b=d.pagecontext.getParamValue("windowid");var c=true;if(b){d.window=$.getIBizApp().findWindow(b);if(d.window){d.viewparam=d.window.viewparam;d.window.setOwnerWindow(window);if(!d.getPController()&&d.window.isShowModal()){c=false;d.window.beforecallback=function(g){var f=d.unloaded();if(f){return{win:window,msg:f}}return f}}}}d.viewparam=$.extend({},d.pagecontext.viewparam,d.viewparam);if(!d.getPController()){if(c){window.onbeforeunload=function(){var f=d.unloaded();if(f){return f}return}}if(d.isAutoLayout()){$(window).resize(function(){d.doLayout()})}}},isClosed:function(){var b=this;if(b.htmlwin){if(b.htmlwin.closed){b.htmlwin=null;return true}try{var a=new Date().getTime();if(a-b.lastTimer>=10000){b.htmlwin=null;return true}else{return false}}catch(c){b.htmlwin=null;return true}}return true},quit:function(){var a=this;a.htmlwin=null},isAutoLayout:function(){var a=this;return a.autoLayout},doLayout:function(){var a=this;if(!a.isAutoLayout()){return}if(a.getPController()){$("#"+a.getCId2()).ibizLayout({ctrler:a});$("#"+a.getCId2()).find(".ibiz-layout").ibizLayout({ctrler:a})}else{$(".ibiz-layout").ibizLayout({ctrler:a})}},onInit:function(){var a=this;if(a.tmpwidth!=undefined||a.tmpheight!=undefined){$("#"+a.getCId2()).width(a.tmpwidth);$("#"+a.getCId2()).height(a.tmpheight)}a.tmpwidth=undefined;a.tmpheight=undefined},setSize:function(b,a){var c=this;if(c.getPController()&&c.isAutoLayout()){if(c.isInited()){$("#"+c.getCId2()).width(b);$("#"+c.getCId2()).height(a);c.doLayout()}else{c.tmpwidth=b;c.tmpheight=a}}},getItem:function(b){var a=this;return a.itemMap[b]},registerItem:function(c,b){var a=this;a.itemMap[c]=b},unloaded:function(){return null},init:function(b){var a=this;if(b){a.parentMode=b.parentMode;a.setParentData(b.parentData)}a.bInited=true;a.onInit();a.initViewLogic();if(!a.getPController()&&a.isAutoLayout()){a.doLayout()}a.fireEvent(ViewControllerBase.INITED,a,{})},asyncInit:function(c){var b=this;b.pagecontext.clear();b.parentMode=c.parentMode;b.setParentData(c.parentData);b.subapp=c.subApp;if(c.renderTo){b.renderTo=$("#"+c.renderTo)}var a;if(c.subApp){a=WEBROOTURL+"/"+c.subApp}else{a=BASEURL}IBiz.ajax({url:a+"/jsp/"+b.config.viewurl,params:c,method:"GET",dataType:"html",success:function(d){b.renderHTML(d);b.init()},failure:function(d){IBiz.alert("","加载内容布局异常",1)}})},renderHTML:function(b){var a=this;if(a.renderTo){a.renderTo.html(b)}},isInited:function(){var a=this;return a.bInited},getCId:function(){var a=this;return a.config.containerid},getCId2:function(){var a=this;var b=a.getCId();if(b!=""){return b+"_"}return b},getAppCtx:function(){var a=this;return a.config.appctx},regController:function(a){var b=this;b.ctrlers[a.getCId()]=a},getController:function(b){var a=this;return a.ctrlers[b]},getPController:function(){var a=this;if(a.config&&a.config.pcontroller){return a.config.pcontroller}return null},unRegController:function(a){var b=this;b.ctrlers[a.getCId()]=null},regCodeList:function(b){var a=this;if(!a.codelists){a.codelists={}}a.codelists[b.getId()]=b},getCodeList:function(a){var b=this;if(b.codelists){return b.codelists[a]}return null},regUIAction:function(b){var a=this;if(!a.uiactions){a.uiactions={}}a.uiactions[b.tag]=b},getUIAction:function(a){var b=this;if(b.uiactions){return b.uiactions[a]}return null},regUICounter:function(a){var b=this;if(!b.uicounters){b.uicounters={}}b.uicounters[a.tag]=a},getUICounter:function(b){var a=this;if(a.uicounters){return a.uicounters[b]}return null},reloadUICounters:function(){var b=this;if(b.uicounters){$.each(b.uicounters,function(c,d){if(d){d.reload()}})}var a=b.getPController();if(a){a.reloadUICounters()}},getWindow:function(){var a=this;return a.window},isEnableViewModel:function(){return false},getBackendUrl:function(){var a=this;if(a.config&&a.config.backendurl){return a.config.backendurl}return null},destroy:function(){var a=this;$.getIBizApp().unRegSRFView(a);a.config=null;arguments.callee.$.destroy.call(this)},refresh:function(){var a=this;a.onRefresh()},onRefresh:function(){},refreshItem:function(a){var c=this;var b=c.getItem(a);if(b){if($.isFunction(b.refresh)){b.refresh();return}if($.isFunction(b.reload)){b.reload();return}}},setParentData:function(a){this.parentData=a;this.onSetParentData()},onSetParentData:function(){},getParentData:function(){var a=this;return a.parentData},getParentMode:function(){var a=this;return a.parentMode},getReferData:function(){var a=this;return a.config.referData},getViewParam:function(){var a=this;return a.viewparam},renderCodeList_Normal:function(a,d,c){var f=this.getCodeList(a);var b=f.getItemByValue(d);if(b==null){return c}return this.getCodeItemText(b)},renderCodeList_NumOr:function(b,h,g,f){if(!f||f==""){f="、"}var j=this.getCodeList(b);if(h==null){return g}var c=parseInt(h);var a="";for(var d=0;d<j.datas.length;d++){var l=j.datas[d];var k=l.value;if((parseInt(k)&c)>0){if(a.length>0){a+=(f)}a+=this.getCodeItemText(l)}}return a},renderCodeList_StrOr:function(c,j,h,g,d){if(!g||g==""){g="、"}var b="";var k=this.getCodeList(c);var a=new Array();a=j.split(d);for(i=0;i<a.length;i++){var f="";f=this.renderCodeList_Normal(c,a[i],h);if(b.length>0){b+=(g)}b+=f}return b},getCodeItemText:function(f){var a=f.color;var d=f.textcls;var c=f.iconcls;var g=f.realtext;var b="";if(c){b=('<i class="'+c+'"></i>')}if(d||a){b+="<span";if(d){b+=(' class="'+d+'"')}if(a){b+=(' style="color:'+a+'"')}b+=">";b+=g;b+="</span>"}else{b+=g}return b},hasHtmlElement:function(a){if($("#"+this.getCId2()+a).length>0){return true}else{return false}},initViewLogic:function(){var c=this;c.onPrepareViewLogics();for(var a in c.viewLogics){var b=c.viewLogics[a];b.init()}},onPrepareViewLogics:function(){},regViewLogic:function(a){var b=this;b.viewLogics[a.getTag()]=a},getViewLogic:function(a){var b=this;return b.viewLogics[a]},invokeCtrl:function(b,f,a){var c=this;if(!b||b==""){c.invoke(f,a)}else{var d=c.getItem(b);if(d){if($.isFunction(d.invoke)){d.invoke(f,a)}}}}});ViewControllerBase.INITED="INITED";var MainViewControllerBase=ViewControllerBase.extend({construct:function(a){arguments.callee.$.construct.call(this,a);this.config=$.extend({},this.config,a)},init:function(a){arguments.callee.$.init.call(this,a);this.caption=null;this.calcToolbarItemState(false)},onInit:function(){arguments.callee.$.onInit.call(this);var a=this;if(a.hasHtmlElement("toolbar")){a.toolbar=a.createToolbar({id:this.getCId2()+"toolbar",ctrler:a});a.toolbar.on(IBizToolbar.ITEMCLICK,function(c,b,f){var d=f.data;d.onClickTBItem(b)},a)}},createToolbar:function(a){return IBiz.createToolbar(a)},onClickTBItem:function(c){var b=this;var a=b.getUIAction(c.tag);b.doUIAction(a,c)},doUIAction:function(b,c){var a=this;if(b){if(b.type=="DEUIACTION"){a.doDEUIAction(b,c);return}if(b.type=="WFUIACTION"){a.doWFUIAction(b,c);return}}},getFrontUIActionParam:function(a){return{}},getBackendUIActionParam:function(a){return{}},openUIActionView:function(f,a){var c=this;var d=$.getIBizApp().createWindow({});d.scope=c;d.title=f.title;d.height=f.height?f.height:0;d.width=f.width?f.width:0;d.url=$.getIBizApp().parseURL2(f.subapp,f.viewurl,{windowid:d.getId(),openerid:c.getId()});d.viewparam=a;var b=false;if(f.openMode=="POPUPMODAL"){b=true}if(b){d.openModal(window)}else{d.openInNewWindow(window)}},doDEUIAction:function(d,g){var c=this;if(d.actionmode=="FRONT"){if((d.fronttype=="WIZARD")||(d.fronttype=="SHOWPAGE")){var b=c.getFrontUIActionParam(d);if(!b){b={}}var h=d.frontview;if(h.redirectview){var f={};f.srfviewparam=JSON.stringify(b);f.srfaction="GETRDVIEW";IBiz.ajax({url:c.getAppCtx()+h.backendurl,params:f,method:"POST",dataType:"json",success:function(j){if(j.ret==0){if(j.rdview){c.openUIActionView(j.rdview,b)}else{IBiz.alert("","无法打开视图，"+j.info,1)}}else{IBiz.alert("","无法打开视图，"+j.info,2)}},failure:function(j){IBiz.alert("","获取打开视图失败,请求异常",2)}});return}c.openUIActionView(h,b);return}if(d.fronttype=="OPENHTMLPAGE"){var a=$.getIBizApp().parseURL2(null,d.htmlpageurl,c.getFrontUIActionParam(d));window.open(a,"_blank");return}}if(d.actionmode=="BACKEND"){var f=c.getBackendUIActionParam(d);if(f==null){return}f.srfuiactionid=d.tag;if(d.confirmmsg){IBiz.confirm(d.confirmmsg,function(j){if(j){c.doBackendUIAction(f)}})}else{c.doBackendUIAction(f)}return}IBiz.alert("","未处理的实体行为["+d.tag+"]",2)},doWFUIAction:function(c,f){var b=this;if(c.actionmode=="WFFRONT"){if((c.fronttype=="WIZARD")||(c.fronttype=="SHOWPAGE")){var d=$.getIBizApp().createWindow({});var a=b.getFrontUIActionParam(c);if(!a){a={}}a.windowid=d.getId();a.openerid=b.getId();$.extend(a,c.frontview.viewparam);d.scope=b;d.title=c.frontview.title;d.height=c.frontview.height?c.frontview.height:0;d.width=c.frontview.width?c.frontview.width:0;d.url=$.getIBizApp().parseURL2(c.frontview.subapp,c.frontview.viewurl,{windowid:d.getId(),openerid:b.getId()});d.viewparam=a;d.callback=function(g){b.onWFUIFrontWindowClosed(g)};if(true){d.openModal(window)}else{d.openInNewWindow(window)}return}}IBiz.alert("","未处理的实体工作流行为["+c.tag+"]",2)},onWFUIFrontWindowClosed:function(b,a){},doBackendUIAction:function(a){IBiz.alert("","未处理的后台界面行为["+a.tag+"]",2)},isShowModal:function(){return false},closeWindow:function(){var a=this;var b=a.getWindow();if(b){b.close(window)}else{window.close()}},getWindow:function(){var a=this;try{if(a.window){var c=$.getIBizApp().findWindow(a.window.getId());if(c!=a.window){a.window=null}}}catch(b){a.window=null}return a.window},getCaption:function(){return this.caption},setCaption:function(a){if(this.caption!=a){this.caption=a;this.fireEvent(MainViewControllerBase.CAPTIONCHANGED,this,this.caption)}},getToolbar:function(){return this.toolbar},calcToolbarItemState:function(a){if(this.toolbar&&this.toolbar.items){$.each(this.toolbar.items,function(b,c){var d=c.attr("data-ibiz-target");if(d=="SINGLEKEY"||d=="MULTIKEY"){c.prop("disabled",!a)}})}},getReferView:function(){var a=this;if(a.pageparams&&a.pageparams.openerid){return $.getIBizApp().getSRFView(a.pageparams.openerid)}return null}});MainViewControllerBase.CAPTIONCHANGED="CAPTIONCHANGED";var SearchViewControllerBase=MainViewControllerBase.extend({construct:function(a){if(a.autoLayout==undefined){if(a.pcontroller){a.autoLayout=a.pcontroller.isAutoLayout()}else{a.autoLayout=true}}arguments.callee.$.construct.call(this,a);var b=this},init:function(b){arguments.callee.$.init.call(this,b);var a=this;a.parentDataChanged=false;if(a.searchform){a.searchform.init();if(a.isLoadDefault()){a.searchform.autoLoad(a.viewparam)}if(a.hasQuickSearch()==true){a.searchform.close()}else{a.searchform.open()}}a.doLayout()},onInit:function(){arguments.callee.$.onInit.call(this);var b=this;var a=b.getBackendUrl()+"srfctrlid=searchform&SRFSUBAPP="+b.subapp+"&";if($("#"+this.getCId2()+"searchcond").length>0){b.bQuickSearch=true;b.quickSearch=$("#"+this.getCId2()+"searchcond")}if(b.quickSearch){b.quickSearch.keyup(function(){if(event.keyCode=="13"){b.onSearchFormSearched()}})}b.quickSearchBtn=$("#"+this.getCId2()+"searchbutton");if(b.quickSearchBtn){b.quickSearchBtn.click(function(c){b.onSearchFormSearched()})}b.moreSearchBtn=$("#"+this.getCId2()+"moresearchbutton");if(b.moreSearchBtn){b.moreSearchBtn.click(function(c){if(b.searchform){if(b.searchform.isOpen()==true){b.searchform.close()}else{b.searchform.open()}b.doLayout()}})}if(b.hasHtmlElement("searchform")){b.searchform=b.createSearchForm({id:this.getCId2()+"searchform",url:a,ctrler:b});b.registerItem("searchform",b.searchform);b.searchform.on(IBizSearchForm.FORMSEARCHED,function(d,c,f){b.onSearchFormSearched()},b);b.searchform.on(IBizSearchForm.FORMRESETED,function(d,c,f){b.onSearchFormReseted()},b);b.searchform.on(IBizForm.FORMFIELDCHANGED,function(f,d,g){var c="";if(f!=null){c=f.getName()}if(!d){d={}}b.onSearchFormFieldChanged(c,f,d.newvalue,d.oldvalue)},b)}},createSearchForm:function(a){return IBiz.createSearchForm(a)},hasQuickSearch:function(){var a=this;return a.bQuickSearch},getSearchForm:function(){return this.searchform},onSearchFormFieldChanged:function(a,d,c){var b=this},onSearchFormReseted:function(){},isLoadDefault:function(){return true},getSearchCond:function(){if(this.getSearchForm()){return this.getSearchForm().getValues()}return null},onSearchFormSearched:function(){},onSearchFormReseted:function(){},onStoreBeforeLoad:function(b,a,d){var c=this;var f={};if(c.viewparam){$.extend(f,c.viewparam)}if(c.getParentMode()){$.extend(f,c.getParentMode())}if(c.getParentData()){$.extend(f,c.getParentData())}if((c.getSearchCond()&&c.searchform.isOpen())||!c.hasQuickSearch()){$.extend(f,c.getSearchCond())}if(c.hasQuickSearch()&&c.quickSearch){a.search=c.quickSearch.val()}$.extend(a,f)},onStoreLoad:function(b,a,d){var c=this;c.parentDataChanged=false;c.reloadUICounters()},onSetParentData:function(){arguments.callee.$.onSetParentData.call(this);this.parentDataChanged=true},onDataActivated:function(a,c){var b=this}});var MDViewControllerBase=MainViewControllerBase.extend({construct:function(a){if(a.autoLayout==undefined){if(a.pcontroller){a.autoLayout=a.pcontroller.isAutoLayout()}else{a.autoLayout=true}}arguments.callee.$.construct.call(this,a);var b=this;b.currentDataKey=null;b.multiSelect=a.multiselect;if(b.multiSelect==undefined){b.multiSelect=true}},init:function(c){arguments.callee.$.init.call(this,c);var b=this;b.parentDataChanged=false;var a=this.getMDCtrl();if(a){a.on(IBizDataGrid.SELECTIONCHANGE,function(f,d,g){b.onSelectionChange(f,d)},b);a.on(IBizDataGrid.BEFORELOAD,function(f,d,g){b.onStoreBeforeLoad(f,d,g)},b);a.on(IBizDataGrid.LOADED,function(f,d,g){b.onStoreLoad(f,d,g)},b)}if(b.getParentMode()){b.doHideParentColumns(b.getParentMode())}if(b.searchform){b.searchform.init();b.searchform.autoLoad(b.viewparam);if(b.hasQuickSearch()==true){b.searchform.close()}else{b.searchform.open()}}b.doLayout()},onInit:function(){arguments.callee.$.onInit.call(this);var b=this;if(b.hasHtmlElement("searchcond")){b.bQuickSearch=true;b.quickSearch=$("#"+this.getCId2()+"searchcond")}if(b.quickSearch){b.quickSearch.keyup(function(){if(event.keyCode=="13"){b.onSearchFormSearched()}})}b.quickSearchBtn=$("#"+this.getCId2()+"searchbutton");if(b.quickSearchBtn){b.quickSearchBtn.click(function(c){b.onSearchFormSearched()})}b.moreSearchBtn=$("#"+this.getCId2()+"moresearchbutton");if(b.moreSearchBtn){b.moreSearchBtn.click(function(c){if(b.searchform){if(b.searchform.isOpen()==true){b.searchform.close()}else{b.searchform.open()}b.doLayout()}})}if(b.hasHtmlElement("searchform")){var a=b.getBackendUrl()+"srfctrlid=searchform&SRFSUBAPP="+b.subapp+"&";b.searchform=b.createSearchForm({id:this.getCId2()+"searchform",url:a,ctrler:b});b.registerItem("searchform",b.searchform);b.searchform.on(IBizSearchForm.FORMSEARCHED,function(d,c,f){b.onSearchFormSearched()},b);b.searchform.on(IBizSearchForm.FORMRESETED,function(d,c,f){b.onSearchFormReseted()},b);b.searchform.on(IBizForm.FORMFIELDCHANGED,function(f,d,g){var c="";if(f!=null){c=f.getName()}if(!d){d={}}b.onSearchFormFieldChanged(c,f,d.newvalue,d.oldvalue)},b)}},createSearchForm:function(a){return IBiz.createSearchForm(a)},hasQuickSearch:function(){var a=this;return a.bQuickSearch},getSearchForm:function(){return this.searchform},getAllData:function(){var a=this;if(a.getMDCtrl()){return a.getMDCtrl().getAllData()}return[]},onSearchFormFieldChanged:function(a,d,c){var b=this},onSearchFormReseted:function(){},onStoreBeforeLoad:function(b,a,d){var c=this;var f={};if(c.viewparam){$.extend(f,c.viewparam)}if(c.getParentMode()){$.extend(f,c.getParentMode())}if(c.getParentData()){$.extend(f,c.getParentData())}if((c.getSearchCond()&&c.searchform.isOpen())||!c.hasQuickSearch()){$.extend(f,c.getSearchCond())}if(c.hasQuickSearch()&&c.quickSearch){a.search=c.quickSearch.val()}$.extend(a,f,{srfaction:"fetch",SRFSUBAPP:c.subapp})},onStoreLoad:function(c,a,f){var d=this;var b=null;if(d.currentDataKey!=null&&d.currentDataKey!=""&&a&&a.items){$.each(a.items,function(h,g){if(g.srfkey==d.currentDataKey){b=g;return false}})}if(b){d.getMDCtrl().setSelection(b);d.calcToolbarItemState(true)}else{d.currentDataKey=null;d.fireEvent(MDViewControllerBase.SELECTIONCHANGE,d,[]);d.calcToolbarItemState(false)}d.parentDataChanged=false;d.reloadUICounters()},onDataActivated:function(a,c){var b=this;if(!a||!a.srfkey){return}b.fireEvent(MDViewControllerBase.DATAACTIVATED,b,[a]);b.currentDataKey=a.srfkey;b.calcToolbarItemState(true);b.onEditData({data:a})},onSelectionChange:function(a,b){var c=this;if(b==null||b.length==0){c.currentDataKey=null}else{c.currentDataKey=b[0].srfkey}c.fireEvent(MDViewControllerBase.SELECTIONCHANGE,c,b);c.calcToolbarItemState(c.currentDataKey!=null)},onNewData:function(){var a=this;var b={};if(a.getViewParam()){$.extend(b,a.getViewParam())}if(a.getParentMode()){$.extend(b,a.getParentMode())}if(a.getParentData()){$.extend(b,a.getParentData())}if(a.isEnableBatchAdd()){a.doNewDataBatch(b);return}if(a.doNewDataWizard(b)){return}a.doNewDataNormal(b)},doNewDataBatch:function(a){var c=this;var d=c.getMPickupView(a);if(d){var f=$.getIBizApp().createWindow({});var b={};$.extend(b,d.viewparam);if(!b.srfreferdata){if(b.srfparentdata){b.srfreferdata=b.srfparentdata;delete b.srfparentdata}}b.windowid=f.getId();b.openerid=c.getId();f.title=d.title;f.scope=c;f.height=d.height?d.height:0;f.width=d.width?d.width:0;f.url=$.getIBizApp().parseURL2(d.subapp,d.viewurl,{windowid:f.getId(),openerid:c.getId()});f.viewparam=b;f.callback=c.onMPickupWindowClose;if(d.modal){f.openModal(window)}else{f.openInNewWindow(window)}return true}return false},onMPickupWindowClose:function(d){var b=d.scope;var f=d.userData;var a=d.dialogResult;if(!a){return}if(a=="ok"){var c=d.selectedDatas;if(!c){return}b.addDataBatch(c)}return},addDataBatch:function(a){IBiz.alert("","[addDataBatch]方法必须重写！",2)},doNewDataWizard:function(a){var d=this;var c=d.getNewDataWizardView(a);if(c!=null){var f=$.getIBizApp().createWindow({});var b={};b.windowid=f.getId();b.openerid=d.getId();f.title=c.title;f.scope=d;f.height=c.height?c.height:0;f.width=c.width?c.width:0;f.url=$.getIBizApp().parseURL2(c.subapp,c.viewurl,{windowid:f.getId(),openerid:d.getId()});f.viewparam=b;f.callback=d.onNewDataWizardWindowClose;if(c.modal){f.openModal(window)}else{f.openInNewWindow(window)}return true}return false},onNewDataWizardWindowClose:function(h,c){var d=h.scope;var j={};var b=h.dialogResult;if(!b){return}if(b=="ok"){var g=h.selectedData;if(g){var f=g.srfkey;j.srfnewmode=f;var a=d.getNewDataView(j);if(a==null){return}d.openDataView(a)}}return},doNewDataNormal:function(a){var c=this;var b=c.getNewDataView(a);if(b==null){return false}return c.openDataView(b)},onEditData:function(a){var b=this;var d={};if(b.getViewParam()){$.extend(d,b.getViewParam())}if(this.getParentMode()){$.extend(d,b.getParentMode())}if(this.getParentData()){$.extend(d,b.getParentData())}if(a.srfcopymode){$.extend(d,{srfsourcekey:a.data.srfkey})}else{$.extend(d,{srfkey:a.data.srfkey})}var c=b.getEditMode(a.data);if(c){d.srfeditmode=c}if(a.data.srfmstag){d.srfeditmode2=a.data.srfmstag}d.openerid=b.getId();b.doEditDataNormal(d)},doEditDataNormal:function(a){var c=this;var b=c.getEditDataView(a);if(b==null){return false}return c.openDataView(b)},openDataView:function(a){var d=this;var c=a.openMode;if(c!=undefined){if(c=="POPUPMODAL"){a.modal=true}else{if(c=="POPUP"){a.modal=true}else{if(c==""||c=="INDEXVIEWTAB"){a.modal=false}}}}if(d.isShowModal()){a.modal=true}var f=$.getIBizApp().createWindow({});var b=a.viewparam;if(!b){b={}}b.windowid=f.getId();b.openerid=d.getId();f.title=a.title;f.scope=d;f.height=a.height?a.height:0;f.width=a.width?a.width:0;f.url=$.getIBizApp().parseURL2(a.subapp,a.viewurl,{windowid:f.getId(),openerid:d.getId()});f.viewparam=b;if(a.modal){f.openModal(window)}else{f.openInNewWindow(window)}return true},getEditMode:function(a){return a.srfdatatype},getEditDataView:function(a){return null},getNewDataView:function(a){return null},getNewDataWizardView:function(a){return null},getMPickupView:function(a){return null},getMDCtrl:function(){IBiz.alert("","[getMDCtrl]方法必须重写！",2)},isLoadDefault:function(){return true},isEnableBatchAdd:function(){return false},isBatchAddOnly:function(){return false},onRefresh:function(){arguments.callee.$.onRefresh.call(this);var a=this;if(a.getMDCtrl()){a.getMDCtrl().load()}},onSetParentData:function(){arguments.callee.$.onSetParentData.call(this);this.parentDataChanged=true},getSearchCond:function(){if(this.getSearchForm()){return this.getSearchForm().getValues()}return null},onSearchFormSearched:function(){if(this.getMDCtrl()){this.getMDCtrl().load()}},onSearchFormReseted:function(){if(this.getMDCtrl()){this.getMDCtrl().load()}},doDEUIAction:function(b,c){var a=this;if(b.tag=="Help"){a.doHelp();return}if(b.tag=="Edit"){a.doEdit();return}if(b.tag=="View"){a.doView();return}if(b.tag=="Print"){a.doPrint();return}if(b.tag=="ExportExcel"){a.doExportExcel(c);return}if(b.tag=="ExportModel"){a.doExportModel();return}if(b.tag=="Copy"){a.doCopy();return}if(b.tag=="Remove"){a.doRemove();return}if(b.tag=="Import"){a.doImport();return}if(b.tag=="Refresh"){a.doRefresh();return}if(b.tag=="New"){a.doNew();return}arguments.callee.$.doDEUIAction.call(a,b,c)},doHelp:function(){IBiz.alert("","帮助操作",0)},doEdit:function(){var b=this;var c=b.getMDCtrl().getSelection();if(c==null||c.length==0){return}var a={data:c[0]};b.onEditData(a)},doView:function(){this.doEdit()},doPrint:function(){var c=this;var a={};var f=true;var d=c.getMDCtrl().getSelection();if(!(d==null||d.length==0)){var b="";if(f){b=d[0].srfkey}else{$.each(d,function(g,j){var h=j.srfkey;if(b!=""){b+=";"}b+=h})}a.srfkeys=b}else{return}c.onPrintData(a)},doExportExcel:function(a){if(a.itemtag==""){}IBiz.alert("","导出操作（Excel）",0)},doExportModel:function(){IBiz.alert("","导出数据模型",0)},doCopy:function(){var b=this;var c=b.getMDCtrl().getSelection();if(c==null||c.length==0){return}var a={data:c[0],srfcopymode:true};b.onEditData(a)},doRemove:function(){IBiz.alert("","删除操作",0)},doImport:function(){IBiz.alert("","数据导入栏",0)},doRefresh:function(){this.refresh()},doNew:function(){var a=this;a.onNewData()},doWFUIAction:function(c,f){var b=this;if(c.actionmode=="WFBACKEND"){var d=b.getMDCtrl().getSelection();if(d==null||d.length==0){return}var a="";$.each(d,function(g,j){var h=j.srfkey;if(a!=""){a+=";"}a+=h});b.getMDCtrl().wfsubmit({srfwfiatag:c.tag,srfkeys:a});return}arguments.callee.$.doWFUIAction.call(this,c,f)},onWFUIFrontWindowClosed:function(c,b){var a=this;a.load()},getFrontUIActionParam:function(d){var c=this;var a={};if(c.getParentMode()){$.extend(a,c.getParentMode())}if(c.getParentData()){$.extend(a,this.getParentData())}var g=false;if(d.actiontarget=="SINGLEKEY"){g=true}var f=c.getMDCtrl().getSelection();if(!(f==null||f.length==0)){var b="";if(g){b=f[0].srfkey}else{$.each(f,function(h,k){var j=k.srfkey;if(b!=""){b+=";"}b+=j})}a.srfkeys=b}return a},getBackendUIActionParam:function(d){var c=this;var a={};if(c.getParentMode()){$.extend(a,c.getParentMode())}if(c.getParentData()){$.extend(a,this.getParentData())}var g=false;if(d.actiontarget=="SINGLEKEY"){g=true}var f=c.getMDCtrl().getSelection();if(!(f==null||f.length==0)){var b="";if(g){b=f[0].srfkey}else{$.each(f,function(h,k){var j=k.srfkey;if(b!=""){b+=";"}b+=j})}a.srfkeys=b}return a},moveRecord:function(j){var g=this;var d=g.getMDCtrl().getStore();if(!d.isLoaded()){return null}var f=d.getCount();var a=0;var c=-1;var h=g.getMDCtrl().getSelection();if(!(h==null||h.length==0)){a=d.indexOf(h[0]);c=a}if(typeof j=="string"){if(j=="first"){a=0}else{if(j=="prev"){a-=1}else{if(j=="next"){a+=1}else{if(j=="last"){a=f-1}}}}}if(a<0||a>=f){return null}if(a==c){return null}var b=d.getAt(a);g.getMDCtrl().setSelection(b);return b},doBackendUIAction:function(a){var b=this;b.getMDCtrl().doUIAction(a)},doHideParentColumns:function(a){},onPrintData:function(a){var b=this;b.doPrintDataNormal(a)},doPrintDataNormal:function(a){var c=this;var b=c.getPrintDataView(a);if(b==null){return false}var d=b.viewurl;if(!d||d==""){d=BASEURL+"/ibizutil/print.pdf"}else{d=BASEURL+d}d=d+(d.indexOf("?")==-1?"?":"&")+$.param(b.viewparam);window.open(d,"_blank");return true},getPrintDataView:function(a){return null},isEnableMultiSelect:function(){return this.multiSelect},setEnableMultiSelect:function(a){this.multiSelect=a}});MDViewControllerBase.DATAACTIVATED="DATAACTIVATED";MDViewControllerBase.SELECTIONCHANGE="SELECTIONCHANGE";